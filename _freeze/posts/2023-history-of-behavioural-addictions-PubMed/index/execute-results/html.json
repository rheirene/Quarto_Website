{
  "hash": "bc4c008d88baec50829be1517a986f3c",
  "result": {
    "markdown": "---\ntitle: \"The history of behavioural addictions research (according to PubMed)\"\ndescription: \"\"\nauthor:\n  - name: Rob Heirene\ncategories: [Gambling] \ndate: 2023-08-25\ndraft: true \n---\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Code: set-up\"}\n# Install and load the groundhog package to ensure consistency of the package versions used here:\n# install.packages(\"groundhog\") # Install\n\nlibrary(groundhog) # Load\n\n# List desired packages:\npackages <- c('readr', # Load dataset from GitHib\n              'RCurl', # Load dataset from GitHib\n              'tidyverse', # Clean, organise, and visualise data\n              'plotly', # Add interactive elements to figures\n              'gganimate', # Make animated plots\n              'png',# Helps render gganimate plots\n              'gifski', # Helps render gganimate plots\n              'rmarkdown', # Helps render gganimate plots\n              'av', # render gganimate plots as videos\n              'Cairo', # Anti-aliasing for the line plots (smoothing output)\n              'ggtext', # make fancy labels in plots\n              'sysfonts', # Special fonts for figures\n              'showtext', # Special fonts for figures\n              'htmlwidgets', # Make plotly plots HTML format for rendering in Quarto\n              'scico', # Colour palette\n              'sessioninfo') # Detailed session info for reproducibility \n\n# Load desired package with versions specific to project start date:\ngroundhog.library(packages, \"2023-08-01\") \n\n# Load new font for figures/graphs\nfont_add_google(\"Poppins\", \"Poppins\")\nfont_add_google(\"Reem Kufi\", \"Reem Kufi\")\nshowtext_auto(enable = TRUE) \n```\n:::\n\n\nOkay, so let's load in the dataset and do a little cleaning:\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Code: load dataset\"}\nurl_behav_addic_data_link <- \"https://raw.githubusercontent.com/rheirene/pub-med-scape-behav-addictions/main/Data%20extraction/combined_results_clean.csv\"\n\nraw_data <- read_csv(url_behav_addic_data_link) %>%\n  as_tibble()\n\nstr(raw_data)\n# View(data)\n\n# Despite my best efforts with manual searching, my explorations of this dataset in R revealed that there are a few erratums/corrigendums and one notice of retraction included in the data. Let's remove these before moving forward:\nfiltered_data <- raw_data %>%\n  filter(str_detect(Publication_Type, \"Erratum\") | \n         str_detect(Publication_Type, \"corrigendum\") | \n         str_detect(Publication_Type, \"Retraction\")) %>% \n  distinct(PMID, .keep_all = TRUE)\n\ndata <- raw_data %>% \n  anti_join(filtered_data)\n```\n:::\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Code: Bar chart of total pubs\"}\n# Compute some summary values will use in the labels:\nn_papers_2022<- data %>%\n  distinct(PMID, .keep_all = TRUE) %>%\n  filter(Year == 2022) %>%\n  distinct(PMID) %>% \n  count() %>%\n  pull()\n\nn_journals_2022<- data %>%\n  distinct(PMID, .keep_all = TRUE) %>%\n  filter(Year == 2022) %>%\n  distinct(Journal_Title) %>% \n  count() %>%\n  pull()\n\n# Prepare data:\ndata_total_per_year_pubs <- data %>%\n   distinct(PMID, .keep_all = TRUE) %>%\n   filter(Year != \"2023\") %>%\n   group_by(Year) %>%\n   count() %>%\n   ungroup() %>%\n  mutate(first_study_1961_label = case_when(Year >= 1961 & Year < 1980 ~ sprintf(\"1961  \\nFirst available study: \\n\\\"Compulsive gambling\\\"\"),\n                               TRUE ~ \"\")) %>%\n  mutate(gam_1980_label = case_when(Year >= 1980 & Year < 1994 ~ sprintf(\"1980  \\nPathological Gambling added \\nto DSM (version III)\"),\n                               TRUE ~ \"\")) %>%\n  mutate(behav_addic_1994_label = case_when(Year >= 1994 & Year < 2004 ~ sprintf(\"1994  \\nFirst mention of \\\"Behavioural \\n addictions\\\" in the literature\"),\n                               TRUE ~ \"\")) %>%\n  mutate(first_gaming_2004_label = case_when(Year >= 2004 & Year < 2013 ~ sprintf(\"2004  \\nFirst available studies \\non gaming addiction\"),\n                               TRUE ~ \"\")) %>%\n  mutate(gam_DSMV_label = case_when(Year >= 2013 & Year < 2020 ~ sprintf(\"2013 \\n\\\"Gambling disorder\\\"\\nadded in \\\"addictive \\ndisorders\\\" class in \\nDSM-V\"),\n                               TRUE ~ \"\")) %>%\n  mutate(final_year_label = case_when(\n    Year >= 2020 & Year < 2023 ~ sprintf(\"2022 \\n%s studies\\n published \\nacross %s  \\njournals\", n_papers_2022, n_journals_2022),\n    TRUE ~ \"\"\n  ))                     \n                   \n # Make plot: \ntotal_year_gganimate <- data_total_per_year_pubs %>%\n   ggplot(aes(Year, n)) + \n   geom_point() + \n   geom_line(size = 1.1, color = \"#289998\") + \n  # Add year counting label\n   geom_text(aes(x = 1984, y = 370, label = as.factor(Year)), hjust = 0, vjust = 0, alpha = 0.6, col = \"#289998\", size = 15, family = \"Reem Kufi\") +\n  # Add 1961 first study label\n  geom_text(aes(x = 1961, y =90, label = first_study_1961_label), hjust = 0, vjust = 0, alpha = 1, col = \"#F5F7F0\", size = 4, family = \"Reem Kufi\") +\n  # Add 1980 gambling label\n  geom_text(aes(x = 1970, y =100, label = gam_1980_label), hjust = 0, vjust = 0, alpha = 1, col = \"#F5F7F0\", size = 4, family = \"Reem Kufi\") +\n  # Add 1994 behavioural addictions label\n  geom_text(aes(x = 1984, y =110, label = behav_addic_1994_label), hjust = 0, vjust = 0, alpha = 1, col = \"#F5F7F0\", size = 4, family = \"Reem Kufi\") +\n  # Add 2004 gaming addiction label\n  geom_text(aes(x = 1994, y =150, label = first_gaming_2004_label), hjust = 0, vjust = 0, alpha = 1, col = \"#F5F7F0\", size = 4, family = \"Reem Kufi\") +\n   # Add 2013 gambling label\n  geom_text(aes(x = 2002, y =260, label = gam_DSMV_label), hjust = 0, vjust = 0, alpha = 1, col = \"#F5F7F0\", size = 4, family = \"Reem Kufi\") +\n  # Add final year label\n  geom_text(aes(x = 2014, y =670, label = final_year_label), hjust = 0, vjust = 0, alpha = 1, col = \"#F5F7F0\", size = 4, family = \"Reem Kufi\") +\n  # Define theme elements\n   theme(\n     plot.background = element_rect(fill = \"#002B36\",  color = NA), # ADDING THIS NA REMOVES BORDER AROUND PLOT ON WEBSITE\n     panel.background = element_rect(fill = \"#002B36\"),\n     text = element_text(family = \"Reem Kufi\", color = \"#F5F7F0\"),\n     axis.text = element_text(color = \"#F5F7F0\", size = 12),\n     panel.grid = element_blank(),\n     plot.margin = margin(20, 5, 20, 20),\n     axis.title.y = element_blank(),  # Adjust y-axis title position\n     axis.title.x = element_text(margin = margin(t = 18), size = 14),\n     plot.title = element_text(color = \"#F5F7F0\", size = 15, margin = margin(b = 10), hjust = -4),\n     plot.subtitle = element_text(color = \"#289998\", hjust = -0.01)\n     # panel.border = element_rect(color = \"#002B36\")\n   ) +\n  scale_x_continuous(breaks = seq(1960, 2020, by = 10), expand = c(.01, 0)) +  # Define x-axis dates & Make the plot fill the available space better\n  scale_y_continuous(limits = c(0, 1000), breaks = seq(0, 750, by = 250)) +  # Define y-axis labels\n  # Add titles and labels\n   labs(\n     title = \"Number of Behavioural Addictions papers published per year on PubMed\",  # Add header\n     subtitle = \"(Up to end of 2022)\",\n     x = \"Year\",\n     caption = \"Rob Heirene (@rheirene)\"\n   ) +\n  theme(plot.caption = element_text(color = \"#289998\",  hjust = .98,\n                                    vjust = .98)) +\n  # Add gganimate animation\n   transition_reveal(Year) \n      # view_follow()\n\n# Animate and present plot:\n# animate(\n#   total_year_gganimate,\n#   width = 700, height = 420, \n#         rewind = FALSE, \n#         type = \"cairo\",\n#   duration = 14,\n#   fps = 12,\n#   renderer = av_renderer()\n# )\n\n # Animate plot in GIF format:\nanimate(total_year_gganimate,\n        width = 700, height = 420,\n        end_pause = 30,\n        type = \"cairo\",\n        duration = 21)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.gif){fig-align='center'}\n:::\n:::\n\n\n\n\n \nHow many in the last 10 years alone?\n\nNow let's start to look publication rates for each \"addiction\" in our dataset.\n\n\n\n\n\n::: {.videoset}\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Code: Bar chart race (publications by addiction)\"}\n# Get palette colors\nnum_labels <- length(unique(data$Label))\npalette_colors <- rev(scico(n = num_labels, palette = 'imola'))\n\n# levels(as.factor(data$Label)) # Check out all behavioural addictions in the dataset\n\n# Prepare the data:\ndata_bar_chart_race_pubs_year<- data %>% \n  # Remove generic behav addictions category:\n  filter(Label != \"behavioural_addictions\") %>%\n    # Tidy the behavioural addiction labels:\n    mutate(Label = str_replace_all(Label, \"_\", \" \") %>%\n                 str_to_title()) %>%\n  # Aggregate the data by behavioural addiction type:\n  group_by(Year, Label) %>% \n  count() %>% \n  ungroup() %>%\n  group_by(Label) %>% \n  mutate(Accumulated_Papers = cumsum(n)) %>% # Produce a variable that is the cumulative sum of studies for each disorder each year (this is what we will be plotting)\n  # This next part is a bit clunky, but we need to find a way to have a value for every addiction for every year, even though we don't have one currently. We can do this by pivoting wider so we create a column for each year then go from there\n  ungroup() %>%\n  mutate(percent = round(n/sum(n)*100, 2))  %>% # just for interest\n  # mutate(Label = factor(Label, levels = unique(Label))) %>%  # order the Label by descending n\n    mutate(Year = paste0(\"label_\", Year)) %>% # so we can select columns later on easily\n  select(-n,\n         -percent) %>% # Remove these columns otherwise it throws off the pivot_longer below and makes multiple rows per date\n  pivot_wider(names_from = Year, values_from = Accumulated_Papers) %>% \n  mutate(label_1961 = case_when(label_1961 == 1 ~ 1,\n                                is.na(label_1961) ~ 0)) %>% # This sets the first year to 0 unless there is a paper published, allowing us to use this as a starting point for imputing values\n  pivot_longer(cols = starts_with(\"label_\"), names_to = \"Year\", values_to = \"Accumulated_Papers\") %>% # now put back into longer format\n  group_by(Label) %>%\n  fill(Accumulated_Papers, .direction = \"down\") %>% # Impute missing values from one above, by addiction type\n    mutate(Year = str_replace(Year, \"label_\", \"\"))  %>% # remove label from the year values\n   ungroup() %>%\n   group_by(Year) %>% \n  # Provide a rank for each addiction that ensures no overlap:\n arrange(Year, desc(Accumulated_Papers), Label) %>%\n  mutate(\n    Rank = row_number(),\n    Rank = ifelse(duplicated(Accumulated_Papers, fromLast = TRUE), Rank - 0.0001, Rank)\n  ) %>%\n  ungroup() \n\n\n# View(data_bar_chart_race_pubs_year) #  Check everything looks okay before proceeding!\n\n# Produce plot:\nbar_chart_race_pubs_year <- \n  data_bar_chart_race_pubs_year %>% \n      ggplot(aes(x = -Rank, y = Accumulated_Papers, fill = Label)) + \n    geom_tile(aes(y = Accumulated_Papers/2, height = Accumulated_Papers), \n              width = 0.9) + \n  coord_flip(clip = \"off\", expand = FALSE) + # Flip\n  # Add year counting label\n   geom_text(aes(y = 2400, x = -24, \n                 label = as.factor(Year)), \n             hjust = 0, vjust = 0, \n             alpha = 0.6, col = \"#289998\", # Alpha not working here for some unknown reason (send help!)\n             size = 14, family = \"Reem Kufi\",\n             inherit.aes = FALSE) + # Adding this didn't fix the alpha issue\n\n  # Add behavioural addiction label\n  geom_text(aes(x = -Rank, y = -100, \n                label = Label),\n            hjust = 1, \n            color = \"#F5F7F0\",\n            family = \"Reem Kufi\") + \n  # Add value label\n  geom_text(aes(y = Accumulated_Papers, \n              label = as.factor(Accumulated_Papers)), # Putting this as a factor is key otherwise it displays decimals to ~10 places at times!\n          hjust = -0.2,\n          color = \"#F5F7F0\",\n          fontface = \"bold\", \n          family = \"Reem Kufi\") +\n  # scale_y_continuous(limits = c(0,3800), breaks = seq(0, 3500, by = 500), expand = c(.01, 0)) +  # Define x-axis dates & Make the plot fill the available space\n    scale_fill_manual(values = palette_colors, guide = FALSE) +\n  theme(legend.position = \"none\") +\n theme(\n     plot.background = element_rect(fill = \"#002B36\",  color = NA), # ADDING THIS NA REMOVES BORDER AROUND PLOT ON WEBSITE\n     panel.background = element_rect(fill = \"#002B36\"),\n     text = element_text(family = \"Reem Kufi\", color = \"#F5F7F0\"),\n     axis.text = element_text(color = \"#F5F7F0\", size = 12),\n     panel.grid = element_blank(),\n     plot.margin = margin(10, 60, 20, 130),\n     axis.text.y = element_blank(), \n     axis.text.x = element_blank(),  # remove x-axis text\n     axis.title = element_blank(),   # remove x-axis title\n     plot.title = element_text(color = \"#F5F7F0\", size = 15, margin = margin(b = 10), hjust = 0.8),\n     plot.subtitle = element_text(color = \"#289998\", margin = margin(b = 17), hjust = -0.4),\n     plot.caption = element_text(color = \"#289998\",  hjust = 1.25,\n                                    vjust = 0.2)\n     # axis.text.y = element_text(size = 12, hjust = 1)\n     # panel.border = element_rect(color = \"#002B36\")\n   ) +\n  # Add titles and labels\n   labs(\n     title = \"Cumulative publications per \\\"addiction\\\" over time\",  # Add header\n     subtitle = \"1961-2023\",\n     caption = \"Rob Heirene (@rheirene)\"\n   ) +\n  transition_states(Year, \n                    wrap = FALSE, # This stops it from rewinding at the end\n                    transition_length = 5, \n                    state_length = 1) +\n   enter_grow() +\n  ease_aes('linear')\n\n# Animate in video format:\n# animate(bar_chart_race_pubs_year, \n#         fps = 20, \n#         end_pause = 50,\n#         duration = 30, \n#         rewind = FALSE,\n#         width = 600, height = 700,\n#         type = \"cairo\",\n#         renderer = av_renderer())\n\n\n# Animate plot in GIF format:\nanimate(bar_chart_race_pubs_year,\n        fps = 20,\n        end_pause = 70,\n        duration = 30,\n        width = 480, height = 670,\n        type = \"cairo\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.gif){fig-align='center'}\n:::\n:::\n\n\n\n\n:::\n \n\n::: {.callout-tip collapse=\"true\" icon=\"false\"}\n## Expand for session information\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Code: Get session info\"}\nsession_info(pkgs = \"attached\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n─ Session info ───────────────────────────────────────────────────────────────\n setting  value\n version  R version 4.3.1 (2023-06-16 ucrt)\n os       Windows 10 x64 (build 19045)\n system   x86_64, mingw32\n ui       RTerm\n language (EN)\n collate  English_United Kingdom.utf8\n ctype    English_United Kingdom.utf8\n tz       Europe/London\n date     2023-08-27\n pandoc   3.1.1 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)\n\n─ Packages ───────────────────────────────────────────────────────────────────\n package     * version   date (UTC) lib source\n av          * 0.8.3     2023-02-05 [1] CRAN (R 4.3.0)\n Cairo       * 1.6-0     2022-07-05 [1] CRAN (R 4.3.0)\n dplyr       * 1.1.2     2023-04-20 [1] CRAN (R 4.3.1)\n forcats     * 1.0.0     2023-01-29 [1] CRAN (R 4.3.1)\n gganimate   * 1.0.8     2022-09-08 [1] CRAN (R 4.3.1)\n ggplot2     * 3.4.2     2023-04-03 [1] CRAN (R 4.3.1)\n ggtext      * 0.1.2     2022-09-16 [1] CRAN (R 4.3.1)\n gifski      * 1.12.0-1  2023-06-08 [1] CRAN (R 4.3.0)\n groundhog   * 3.1.0     2023-05-05 [1] CRAN (R 4.3.1)\n htmlwidgets * 1.6.2     2023-03-17 [1] CRAN (R 4.3.1)\n lubridate   * 1.9.2     2023-02-10 [1] CRAN (R 4.3.1)\n plotly      * 4.10.2    2023-06-03 [1] CRAN (R 4.3.1)\n png         * 0.1-8     2022-11-29 [1] CRAN (R 4.3.0)\n purrr       * 1.0.1     2023-01-10 [1] CRAN (R 4.3.1)\n RCurl       * 1.98-1.12 2023-03-27 [1] CRAN (R 4.3.1)\n readr       * 2.1.4     2023-02-10 [1] CRAN (R 4.3.1)\n rmarkdown   * 2.23      2023-07-01 [1] CRAN (R 4.3.1)\n scico       * 1.4.0     2023-05-30 [1] CRAN (R 4.3.0)\n sessioninfo * 1.2.2     2021-12-06 [1] CRAN (R 4.3.1)\n showtext    * 0.9-6     2023-05-03 [1] CRAN (R 4.3.1)\n showtextdb  * 3.0       2020-06-04 [1] CRAN (R 4.3.1)\n stringr     * 1.5.0     2022-12-02 [1] CRAN (R 4.3.1)\n sysfonts    * 0.8.8     2022-03-13 [1] CRAN (R 4.3.1)\n tibble      * 3.2.1     2023-03-20 [1] CRAN (R 4.3.1)\n tidyr       * 1.3.0     2023-01-24 [1] CRAN (R 4.3.1)\n tidyverse   * 2.0.0     2023-02-22 [1] CRAN (R 4.3.1)\n\n [1] C:/Users/rheirene/AppData/Local/R/win-library/4.3\n [2] C:/Program Files/R/R-4.3.1/library\n\n──────────────────────────────────────────────────────────────────────────────\n```\n:::\n:::\n\n:::\n\n------------------------------------------------------------------------\n\n\n```{=html}\n<script src=\"https://giscus.app/client.js\"\n        data-repo=\"rheirene/Quarto_Website\"\n        data-repo-id=\"R_kgDOJ0d4fA\"\n        data-category-id=\"DIC_kwDOJ0d4fM4CXv7I\"\n        data-mapping=\"pathname\"\n        data-strict=\"0\"\n        data-reactions-enabled=\"1\"\n        data-emit-metadata=\"0\"\n        data-input-position=\"bottom\"\n        data-theme=\"dark_dimmed\"\n        data-lang=\"en\"\n        crossorigin=\"anonymous\"\n        async>\n</script\n```\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}