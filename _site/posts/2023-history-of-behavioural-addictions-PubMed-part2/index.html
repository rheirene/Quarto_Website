<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Rob Heirene">
<meta name="dcterms.date" content="2023-08-25">

<title>Rob Heirene - The history of behavioural addictions research (according to PubMed): Part 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../files/logo.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Rob Heirene - The history of behavioural addictions research (according to PubMed): Part 2">
<meta property="og:description" content="">
<meta property="og:image" content="filtered_publications_map.gif">
<meta property="og:site-name" content="Rob Heirene">
<meta name="twitter:title" content="Rob Heirene - The history of behavioural addictions research (according to PubMed): Part 2">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="filtered_publications_map.gif">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Rob Heirene</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../posts.html" rel="" target="">
 <span class="menu-text">Addiction Science Blog</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publication.html" rel="" target="">
 <span class="menu-text">Publications</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="mailto:robheirene@gmail.com" rel="" title="" class="quarto-navigation-tool px-1" aria-label="email"><i class="bi bi-envelope-fill"></i></a>
    <a href="https://github.com/rheirene" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="https://scholar.google.co.uk/citations?user=2bz0qnsAAAAJ&amp;hl=en" rel="" title="" class="quarto-navigation-tool px-1" aria-label="Scholar"><i class="bi bi-mortarboard-fill"></i></a>
    <a href="https://osf.io/atwg5/" rel="" title="" class="quarto-navigation-tool px-1" aria-label="osf.io"><i class="bi bi-door-open"></i></a>
    <a href="https://twitter.com/RHeirene" rel="" title="" class="quarto-navigation-tool px-1" aria-label="twitter"><i class="bi bi-twitter"></i></a>
    <a href="https://www.linkedin.com/in/robert-heirene/" rel="" title="" class="quarto-navigation-tool px-1" aria-label="linkedin"><i class="bi bi-linkedin"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">The history of behavioural addictions research (according to PubMed): Part 2</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">Gambling</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Rob Heirene </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 25, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-code-set-up" id="toc-data-code-set-up" class="nav-link active" data-scroll-target="#data-code-set-up">Data &amp; code set-up</a></li>
  <li><a href="#where-do-these-papers-come-from" id="toc-where-do-these-papers-come-from" class="nav-link" data-scroll-target="#where-do-these-papers-come-from">Where do these papers come from?</a></li>
  <li><a href="#where-are-these-published" id="toc-where-are-these-published" class="nav-link" data-scroll-target="#where-are-these-published">Where are these published?</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="data-code-set-up" class="level3">
<h3 class="anchored" data-anchor-id="data-code-set-up">Data &amp; code set-up</h3>
<p>Just like in Part 1, Iâ€™ll first load all the required packages and fonts for figures.</p>
<div class="cell">
<details>
<summary>Code: load packages</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install and load the groundhog package to ensure consistency of the package versions used here:</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("groundhog") # Install</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(groundhog) <span class="co"># Load</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># List desired packages:</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>packages <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'readr'</span>, <span class="co"># Load dataset from GitHib</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">'tidyverse'</span>, <span class="co"># Clean, organise, and visualise data</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>              <span class="st">'gt'</span>, <span class="co">#  table data</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>              <span class="st">'gtExtras'</span>, <span class="co"># Add colours to gt tables</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>              <span class="st">'plotly'</span>, <span class="co"># Add interactive elements to figures</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>              <span class="st">'gganimate'</span>, <span class="co"># Make animated plots</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">'transformr'</span>, <span class="co"># Needed for certain animations (dumbell lines)</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>              <span class="st">'png'</span>,<span class="co"># Helps render gganimate plots</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>              <span class="st">'gifski'</span>, <span class="co"># Helps render gganimate plots</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>              <span class="st">'rmarkdown'</span>, <span class="co"># Helps render gganimate plots</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>              <span class="st">'av'</span>, <span class="co"># render gganimate plots as videos</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>              <span class="st">'Cairo'</span>, <span class="co"># Anti-aliasing for the line plots (smoothing output)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>              <span class="st">'ggtext'</span>, <span class="co"># make fancy labels in plots</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>              <span class="st">'sysfonts'</span>, <span class="co"># Special fonts for figures</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>              <span class="st">'showtext'</span>, <span class="co"># Special fonts for figures</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>              <span class="st">'htmlwidgets'</span>, <span class="co"># Make plotly plots HTML format for rendering in Quarto</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>              <span class="st">'scico'</span>, <span class="co"># Colour palette</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>              <span class="st">'maps'</span>, <span class="co"># Get map/geographic data for author locations</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>              <span class="st">'purrr'</span>, <span class="co"># Help unnest city and author names across papers  equally</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>              <span class="st">'stringr'</span>, <span class="co"># extract city names</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>              <span class="st">'viridis'</span>, <span class="co"># More colour palettes</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>              <span class="st">'sessioninfo'</span>) <span class="co"># Detailed session info for reproducibility </span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Load desired package with versions specific to project start date:</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="fu">groundhog.library</span>(packages, <span class="st">"2023-08-01"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details>
<summary>Code: fonts &amp; themes</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load new font for figures/graphs</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">font_add_google</span>(<span class="st">"Poppins"</span>, <span class="st">"Poppins"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">font_add_google</span>(<span class="st">"Reem Kufi"</span>, <span class="st">"Reem Kufi"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">showtext_auto</span>(<span class="at">enable =</span> <span class="cn">TRUE</span>) </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>plot_theme <span class="ot">&lt;-</span>  <span class="fu">theme</span>(<span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#002B36"</span>,  <span class="at">color =</span> <span class="cn">NA</span>), <span class="co"># ADDING THIS NA REMOVES BORDER AROUND PLOT ON WEBSITE</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"#002B36"</span>),</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">"Reem Kufi"</span>, <span class="at">color =</span> <span class="st">"#F5F7F0"</span>),</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"#F5F7F0"</span>, <span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"#F5F7F0"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"#50B5C8"</span>, <span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"#50B5C8"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now Iâ€™ll load in the dataset and do a little cleaning. Again,, Iâ€™m going to remove all publications from 2023 so that we only have data for complete years (see comments in the code chunk below for any other exclusions).</p>
<div class="cell">
<details>
<summary>Code: load dataset</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>url_behav_addic_data_link <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/rheirene/pub-med-scape-behav-addictions/main/Data%20extraction/combined_results_clean.csv"</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url_behav_addic_data_link) <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(raw_data)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># View(data)</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Despite my best efforts with manual searching, my explorations of this dataset in R revealed that there are a few erratums/corrigendums and one notice of retraction included in the data. Let's remove these before moving forward:</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>filtered_data <span class="ot">&lt;-</span> raw_data <span class="sc">%&gt;%</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">str_detect</span>(Publication_Type, <span class="st">"Erratum"</span>) <span class="sc">|</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">str_detect</span>(Publication_Type, <span class="st">"corrigendum"</span>) <span class="sc">|</span> </span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">str_detect</span>(Publication_Type, <span class="st">"Retraction"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(PMID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's now remove these pubs and any from 2023 so we have data for all "full" years:</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> raw_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(filtered_data) <span class="sc">%&gt;%</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Year <span class="sc">!=</span> <span class="st">"2023"</span>) </span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co"># View(data)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="where-do-these-papers-come-from" class="level3">
<h3 class="anchored" data-anchor-id="where-do-these-papers-come-from">Where do these papers come from?</h3>
<p>I want to to visualise this information, but itâ€™s going to be quite tricky as each paper has a variable number of authors and therefore institution addresses, all of which are listed in a single (often messy) string within one column in the dataset. Iâ€™ll have to separate out each author institution and then find a way to extract only the relevant information to be able to geo-locate them.</p>
<div class="cell">
<details>
<summary>Code: Extract location data for each paper</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ***********************The below code is almost all commented out on purpose as the process of extracting and matching city names from the author address column is so computationally taxing that it takes a long time to process.  I've left the code here so that anyone can see how I did it, but I saved the results as a .csv file and now load the data like that***********************</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># # as_tibble(data$Author_Address) # Take a look at how the author addresses are structured</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # Okay, so we're going to need to create an ID variable for each paper (this makes the string split and a nest below work bettter than relying on titles), then split the author_address strings into separate addresses, then unnest these into new rows. </span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># # Whilst I'm splitting and unnesting the author address: I'm going to simultaneously do this for the authors name column.</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># # The un-nest doesn't seem to work well when we retain all of the columns in the dataset, so I do it with only id and institution (address) in the data, then join all of the rest of the data set to the unnested rows after this. For this to work, we need to create a dataset that has the ID variable in before splitting the string and and unnesting. Let's do that:</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#  data_id &lt;-data %&gt;%</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   rowid_to_column(var = "id")</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#  pad_vector &lt;- function(vec, len) {</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   length(vec) &lt;- len</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   return(vec)</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co">#  }</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># # Now split the author and address strings and then  unnest it into multiple rows, and finally re-join with the main dataset</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># data_locations &lt;- data_id %&gt;%</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a><span class="co">#      institution = str_split(Author_Address, ";"), # Split author address column into separate strings For each address</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co">#     author_names = str_split(Full_Author_Name, ";") # Split author name column into separate strings For each Name</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co">#   # The below code matches the number of author institutions and author names where discrepancies exist, so the unnest further below works:</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">#    mutate(</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co">#     max_length = pmax(map_int(institution, length), map_int(author_names, length)),</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="co">#     institution = map2(institution, max_length, ~ pad_vector(., .y)),</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="co">#     author_names = map2(author_names, max_length, ~ pad_vector(., .y))</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(id, institution, author_names) %&gt;%</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   unnest(c(institution, author_names)) %&gt;%</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Looking at the data at this point, there's a lot of white space around the institutions and author names. Let's remember that now:</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(institution = str_trim(institution, side = "both"),</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="co">#          author_names = str_trim(author_names, side = "both")) %&gt;%</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   full_join(data_id, by = "id") %&gt;%</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Whilst we're doing this, we'll also create a counter/number for each institution per paper</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(id) %&gt;%</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(author_num = row_number()) %&gt;%</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   # We can also pivot to wide format if that makes sense at any point:</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co">#   # pivot_wider(names_from = author_num,</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co">#   #             values_from = institution,</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co">#   #             names_prefix = "author_",</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">#   #             values_fill = NA_character_)</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co"># # View(data_locations) # Looks good!</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="co"># # Uncomment from below this line</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a><span class="co"># # Fortunately, the "maps"  package contains a list of city names that we can use to match with our author institutions. Let's load the relevant data:</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="co"># ## Loading country data from package maps</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="co"># data(world.cities)</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a><span class="co">#  # The way the matching process works below is by picking the first match in the string, so removing all of the cities below actually leads to an increase in proper matches as the wrong matches are skipped over:</span></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co"># world_cities_filtered &lt;-  world.cities %&gt;%</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!name %in% c("China", # There is a city in Mexico called China, and including this in the dataset needed to pick up any papers published in China and link them to this city!</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="co">#                         "India", # Same sort of issue (City in Africa)</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="co">#                         "San",  # Same sort of issue (City in Africa, again)</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="co">#                         "Institut", # This appears to be a City somewhere around Azerbaijan, but I think it's getting picked up as a city when in fact it just is a string in the author address referring to a university!</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a><span class="co">#                        "Santa", # This is picked up as a city In Peru, when in fact  with just part of the name of many different institutions</span></span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "God", # This is picked up as the name of a city in the Hungary, when in fact is just  part of the name of a hospital in Ireland</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Normal", # This is picked up as a city in the US  when in fact it's part of a university name in China</span></span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Bar", # This is picked up as a city in Ukraine, when in fact it's just the name of the University in Israel</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Victoria", #  This leads to confusion between Victoria in Canada and the state in Australia. Easier just to remove rather than be inaccurate</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Cardinal",</span></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Villanueva", # This is actually a university in Spain, but it's picked up as a city in Honduras</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Beira", # This is picked up as a city of Mozambique, but eventually the University Hospital name in Portugal</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Cardinal",</span></span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Young", # This is picked up as a city in Uruguay, when is just part of the name of a young adult hospital in France</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a><span class="co">#           </span></span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Cornwall", # Get picked up as a city in Canada and not the area of the UK</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a><span class="co">#                        "George", #  A street name in the US,  confused for the South African city</span></span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a><span class="co">#                        "Imperial", #  part of a UK university name but picked up as a city in Peru</span></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Laval", # Part of a university name in Canada but gets picked up as the city in France</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Villa", # Part of the name of a institution in Italy, but picked up as the Estonian city.</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Aidu", # Part of the name of a Japanese hospital, but picked up as a Estonian city</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Carolina", # Part of the US state name in the data, but picked up as a city in Peurto Rico</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a><span class="co">#                        "Carmel", # Get confused with the US city, but always Israel in the dataset</span></span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "U",#  seems like shorthand for an address in France, but has picked up as a city in Micronesia and the French city is missed</span></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Ramon",  # Part of the name of a hospital in Spain, but picked up as the city in the Philippines</span></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Fundacion", #  Part of the name of a institution in Spain, but picked up as a city in Colombia</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Trinidad", # Part of a institution name in Argentina, were picked up as a city in Bolivia</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Liege",# Picked up as a city in Belgium, but it's actually part of a name of a place in France</span></span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "East London", # Refers to the UK University, picked up as a city in South Africa</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Florida", # University name picked up as a city in Cuba</span></span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Ita", # Part of the name of a institution in Finland picked up as the city in Paraguay</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Princeton", #  University name confused for the city in Canada</span></span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Humboldt", # Confused for the Canadian city, but actually a University in Germany</span></span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Alcala", # Confused for the Colombian city, but actually part of a university name in Spain)</span></span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a><span class="co">#                             "York", # UK Canada confusion. Easier to remove</span></span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Union", # Typically refers to the European Union, but confuse for the US city</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "La Rioja", # Part of a Spanish University but computer the city in Argentina</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Concord", # Area in Australia that ends up being linked to a US city rather</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Nanyang", # Part of a Singapore university name that gets linked to a city in China</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Patan", # Part of a Napoleon University name that gets linked to a cityin India</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Saint-Joseph", # University name in Lebanon on that gets linked to a city in Reunion</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Valencia", # University in Spain that gets linked to Venezuela</span></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Ingenio", # Institution in Spain that gets linked to the Canary Islands</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Lincoln", # UK university name that gets linked to the US</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Roma", # Italian street name that gets linked to Australia</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Leon", # Institution name in France forgets links to Mexico</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Pau", # Part of a hospital name in Spain that Gets linked to France</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Ilan", # Part of a university name in Israel that gets linked to Taiwan</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Street", #  an obvious issue. Linked to the UK incorrectly</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Alle",  # Incorrectly linked to Switzerland when it's an address in Denmark'Hashtag</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "San Ignacio", # Location improved its link to Bolivia</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Carnot", # Street in France that gets linked to central Africa</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Mexico", #  country gets incorrectly linked to the Philippines city</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Mobile", #  Institution in Canada that gets incorrectly linked to the US</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Hebron", # Location in Spain gets mixed up with Palestine</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Liban", #  hospital in France that gets linked to Czech Republic</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a><span class="co">#                      </span></span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Bayonne", # Addiction clinic in France linked to the US incorrectly</span></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Apartado", # Confusion between Spain and Colombia. Better to just remove</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Rioja", # Appears in a few different places and can be linked to Spain or Peru</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Li", #  part of a university name in China can be linked to Norway incorrectly</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Al", # Part of the name of places in Saudi Arabia and other countries that gets picked up as a city in Norway</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "San Agustin", # Part of the name of a place in Peru that getting linked to Mexico</span></span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Asia", # A city name in the Philippines that is obviously going to give problems</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Jordan", #  country name acts incorrectly linked to the Philippines city</span></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Kota", # Location in Malaysia that gets linked to India incorrectly</span></span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Ribera", # Part of an institution name in Spain gets linked to Italy</span></span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Pilar", # Name of a Institute in Croatia that gets linked to Brazil incorrectly</span></span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "Greenwich", # Causes various problems due to being linked to the US and UK</span></span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a><span class="co">#                       "George Town", #In Malaysia, baguettes linked to the Cayman Islands</span></span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Worth", # Should the Fort Worth in America, baguettes link to Germany</span></span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Santa Lucia", # Name of a institution in Italy that gets confused at the Canary Islands</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Sainte Anne", # Name of an institution in France that gets confused with the city in Canada</span></span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Douglas", # Part of a university name inCanada gets confused with the Isle of Man</span></span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Arizona", # State name gets confused for a city in Honduras</span></span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Potsdam", # In New York gets confused with Germany</span></span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Kita", # In the name of an Indonesian institution that gets confused with the city in Mali</span></span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Concordia", # US university name gets confused with a town in Argentina</span></span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Bay", # Monterey Bay gets confused with a town in the Philippines</span></span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Parana", # Part of an institution name in Brazil gets linked to Argentina</span></span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Gazi", # Incorrectly gets linked to Ken year when it should be part of a name of a university in Turkey</span></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Wufeng",# incorrectly linked to China when it should be in Taiwan</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Loo", # Getting correctly linked to Estonia when it's actually part of a institution name in Singapore</span></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Police", # Police college accidentally linked to city in Poland</span></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Long", # Thia city and in the name of yale uni address</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "David", # City in Panama that causes obivous issues</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Naval", # City in the Philippines that causes obvious issues</span></span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Hall", # City in the Philippines that causes obvious issues</span></span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a><span class="co">#                      "Trinity" # Irish uni name but gets mistaken to Jersey city</span></span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a><span class="co">#                      )) %&gt;% </span></span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a><span class="co">#   # A combination of city names and country names can be used to keep the city where it seems like it can be saved:</span></span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(city_country = paste0(name,", ", country.etc)) %&gt;% </span></span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!city_country %in% c("Sussex, Canada",# Only the UK one appears and this gets confused</span></span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Milton, Canada", #  should be Milton Keynes in the UK</span></span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Bathurst, Canada", # Location in Australia they get confused Canada</span></span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Milton, New Zealand", #  should be Milton Keynes in the UK</span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Orleans, France", #  incorrectly linked to France, not Canada</span></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Bergen, Norway", # teams to be linked consistently to the US,  but mistaken for Norway</span></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Penrith, UK", # Should be the Australian city near Sydney</span></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Bedford, UK", #  location in Australia gets Linked to the UK incorrectly</span></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Bedford, USA", #  location in Australia gets Linked to the US incorrectly</span></span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Salt, Spain", # Should be Salt Lake City, US,  but gets picked up as the Spanish city</span></span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Lancaster, USA", #  should be the UK</span></span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Ho, Ghana", # Part of an address in Taiwan that's getting linked to Ghana</span></span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Laguna, USA", # Should be the canary islands, surprisingly</span></span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Albert, France",</span></span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a><span class="co">#                               "Hong, Denmark",# Leads to this being picked up and said of Hong Kong</span></span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Durham, USA", # Should be the UK one</span></span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Brest, Belarus", # Refers to France not Belarus</span></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Warwick, USA", #  Always seems to refer to the UK university, but the Use of the US city</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Belmont, Canada", #  Always seems to refer to the US,  but confused for the Canadian city</span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Beaufort, Malaysia", # Should be the American city</span></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Mackay, Australia", #  should always be the location in Taiwan</span></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Alicante, Philippines", #  should always be in Spain</span></span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a><span class="co">#                              "Malaya, Philippines", # Should be in Malaysia</span></span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a><span class="co">#                            "Claremont, Jamaica", #  Australian location that gets sent to Jamaica, incorrectly</span></span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a><span class="co">#                            </span></span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a><span class="co">#                            "Colombia, Cuba", # Get confused with the country</span></span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a><span class="co">#                            "Carlton, UK", #Street name in Canada gets confused with the UK</span></span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a><span class="co">#                            "Costa Rica, Mexico", # Obviously get complete. The country</span></span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a><span class="co">#                            "Notre Dame, Mauritius", #  actually the Australian University!</span></span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a><span class="co">#                             "Baja, Hungary", # University namely Mexico</span></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a><span class="co">#                            "Palmerston, Australia", #  links to the northern Australian city, rather than New Zealand</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a><span class="co">#                            "Waterloo, USA" # Always the Canadian university</span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a><span class="co">#          )) %&gt;% </span></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a><span class="co">#    group_by(name) %&gt;%</span></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(pop == max(pop)) %&gt;% # Okay, so this is imperfect, but when a city name is duplicated that I haven't accounted for above, this will filter to select only the one with the highest population. This is based on the assumption that papers are likely to come from more populated cities (i.e. those with universities). This may seem crude, but it solved many, many issues in the map.</span></span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() </span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a><span class="co"># # Extract just the city names so we can try and match author locations using these:</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a><span class="co"># city_names_from_world &lt;- world_cities_filtered$name</span></span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create a pattern of city names for matching with word boundaries:</span></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a><span class="co"># city_names_pattern &lt;- paste("\\b(", paste(city_names_from_world, collapse = "|"), ")\\b", sep = "")</span></span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a><span class="co"># # Extract city names using stringr (the str_exact function extracts the first complete match from a string; the arguments are the string and then the match we're looking for)</span></span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a><span class="co"># cities_of_authors &lt;- str_extract(data_locations$institution, city_names_pattern)</span></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a><span class="co"># # Before we join this to our dataset, let's now do the same thing for countries, using the world dataset. We could just link countries to the existing cities we identified, but this won't give us the richest overall data, as in some cases it might find a country name but no city name and vice versa.</span></span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a><span class="co"># # Extract just the Country names so we can try and match author locations using these:</span></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a><span class="co"># country_names &lt;- world.cities$country.etc</span></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create a pattern of Country names for matching with word boundaries:</span></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a><span class="co"># country_names_pattern &lt;- paste("\\b(", paste(country_names, collapse = "|"), ")\\b", sep = "")</span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a><span class="co"># # Extract country names using stringr (the str_exact function extracts the first complete match from a string; the arguments are the string and then the match we're looking for)</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a><span class="co"># countries_of_authors &lt;- str_extract(data_locations$institution, country_names_pattern)</span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add the extracted city and country names to our dataset:</span></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a><span class="co"># data_locations_with_city_country&lt;- data_locations %&gt;%</span></span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a><span class="co">#   bind_cols(cities_of_authors,</span></span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a><span class="co">#             countries_of_authors) %&gt;%</span></span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(cities_of_authors = 19,</span></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a><span class="co">#          countries_of_authors = 20)</span></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a><span class="co"># # Check everything looks okay:</span></span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a><span class="co"># #  select(author_names,</span></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a><span class="co"># #         cities_of_authors,</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a><span class="co"># #         countries_of_authors) %&gt;%</span></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a><span class="co"># #  print(n=150)</span></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a><span class="co"># # Make the city name column consistent with paper dataset:</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a><span class="co"># world_cities_filtered &lt;- as_tibble(world_cities_filtered) %&gt;%</span></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(cities_of_authors = name)</span></span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a><span class="co"># #Join the world.cities dataset with our paper data so we have latitude and longitude for each city:</span></span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a><span class="co"># data_locations_with_full_geo_location&lt;-</span></span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(data_locations_with_city_country,</span></span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a><span class="co">#            world_cities_filtered,</span></span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a><span class="co">#            by = join_by(cities_of_authors) # This is done purposely, as I want to check whether the country names matched in text above match with the country names linked to the city names. Any mismatches tell us a lot about whether it got the right city are not and how I filtered out most of the problematic cities above!</span></span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a><span class="co">#            )</span></span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a><span class="co"># # Now, Save this to a CSV file because this took forever to extract the data we don't want to have to do this every time I render this page!!</span></span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(data_locations_with_full_geo_location, "posts/2023-history-of-behavioural-addictions-PubMed-part2/data_locations_with_full_geo_location.csv")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Phew, that was intense. It was computationally demanding to link &gt;40,000 author addresses to one out of every single city and country name worldwide so iâ€™ve saved the dataset to Github and nowIâ€™ll load it in from there and do some cleaning.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The code here is terrible. I'm sorry!</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Okay, now actually load pre-created data from Github:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>url_geo_loc_data_link <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/rheirene/Quarto_Website/master/posts/2023-history-of-behavioural-addictions-PubMed-part2/data_locations_with_full_geo_location.csv"</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>data_locations_with_full_geo_location <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(url_geo_loc_data_link) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
Rows: 42537 Columns: 27
â”€â”€ Column specification
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Delimiter: "," chr
(18): institution, author_names, Title, Month, DOI, Abstract, Full_Autho... dbl
(9): ...1, id, PMID, Year, author_num, pop, lat, long, capital
â„¹ Use `spec()` to retrieve the full column specification for this data. â„¹
Specify the column types or set `show_col_types = FALSE` to quiet this message.
â€¢ `` -&gt; `...1`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking for mismatches betweencountries matched to cities I extracted and countries matched by text (as I do below) is how I spotted most of the problematic cities.</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># names(data_locations_with_full_geo_location)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Install proper  spelling of names in world cities dataset:</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>world.cities <span class="sc">%&gt;%</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(name == "Turin")</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(country.etc <span class="sc">==</span> <span class="st">"Canary Islands"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's explore this data to see any mismatches</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a> data_locations_with_full_geo_location <span class="sc">%&gt;%</span> </span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(countries_of_authors <span class="sc">!=</span> country.etc) <span class="sc">%&gt;%</span> <span class="co"># Identify and isolate mismatches</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(institution,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>       author_names,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>         cities_of_authors,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>         countries_of_authors,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>       country.etc) <span class="sc">%&gt;%</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="dv">350</span>) <span class="co"># Started with several thousand</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Looking at the results above, it's clear we need to prioritise matched country (i.e., the one we extracted from the text) over the linked one (linked to city name from database) as mistake are rate with the matched one as it's simple text extraction, whereas the link from city to country can be fallible as there are multiple cities with the same nameand it could have matched with the wrong city.</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a><span class="co"># There are a few important caveats to the above that we will need to directly recode for accuracy:</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Georgia USA. This gets extracted as the country, but it's obviously the state in the US! Also, the city in Georgia, Athens gets links to Greece incorrectly. </span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Mongolia.  Inner Mongolia normal University appears to be in China, but gets extracted as in Mongolia </span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Mexico. The University of New Mexico often gets linked to the country Mexico when it should be the US</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Jersey. Gets linked to the small country south of the UK, instead of the University of New Jersey!</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a><span class="co"># There are also a few key cities that are duplicated that I didn't remove in the filtering above that will need directly linking via code to the right city and country, including Cambridge, New York, London, Oxford, Liverpool, Bristol, Reading, Columbia, Northampton, Stirling, Aberdeen and Newport</span></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a> <span class="co"># Check allpotential problematic locations:</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a> data_locations_with_full_geo_location <span class="sc">%&gt;%</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(countries_of_authors  == "Georgia") %&gt;% </span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(countries_of_authors  == "Mongolia") %&gt;% </span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(countries_of_authors  == "Mexico") %&gt;% </span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(countries_of_authors  == "Jersey") %&gt;% </span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(countries_of_authors  == "Jersey") %&gt;% </span></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(str_detect(institution, "Columbia")) %&gt;% # Check anywhere for this one!</span></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  filter(str_detect(institution, "Colombia")) %&gt;% # Check anywhere for this one!</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(str_detect(cities_of_authors, "Marietta")) %&gt;% </span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(str_detect(cities_of_authors, "Liverpool")) %&gt;%</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(str_detect(cities_of_authors, "Reading")) %&gt;%</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(str_detect(cities_of_authors, "Northampton")) %&gt;%</span></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(str_detect(cities_of_authors, "Stirling")) %&gt;%</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>   <span class="co"># filter(str_detect(cities_of_authors, "Cambridge")) %&gt;% </span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a> <span class="co"># filter(str_detect(cities_of_authors, "Aberdeen")) %&gt;%</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a> <span class="co"># filter(str_detect(cities_of_authors, "Newport")) %&gt;%</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(str_detect(cities_of_authors, "Oxford")) %&gt;%</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>   <span class="fu">filter</span>(<span class="fu">str_detect</span>(institution, <span class="st">"Kfar-Saba"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(institution,</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>       author_names,</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>         cities_of_authors,</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>         countries_of_authors,</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>       country.etc) <span class="sc">%&gt;%</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n=</span><span class="dv">350</span>)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>data_locations_with_full_geo_location_cleaned <span class="ot">&lt;-</span> </span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a> data_locations_with_full_geo_location <span class="sc">%&gt;%</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cities_of_authors =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort Georgia country/Athens city issues:</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Georgia State"</span>) <span class="sc">~</span> <span class="st">"Atlanta"</span>,</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"University of Georgia"</span>) <span class="sc">~</span> <span class="st">"Athens"</span>,</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Georgia College"</span>) <span class="sc">~</span> <span class="st">"Milledgeville"</span>,</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    <span class="co">#  Mongolia city issues:</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Inner Mongolia"</span>) <span class="sc">~</span> <span class="st">"Hothot"</span>,</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Mexico City issues:</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"University of New Mexico"</span>) <span class="sc">~</span> <span class="st">"Albuquerque"</span>,</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Jersey issues:</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Rutgers"</span>) <span class="sc">&amp;</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">str_detect</span>(institution, <span class="st">"Camden"</span>) <span class="sc">&amp;</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">str_detect</span>(institution, <span class="st">"New York"</span>) <span class="sc">~</span> <span class="st">"New Brunswick"</span>, <span class="co"># this isn't perfect, but cities are often missing for Rutgers</span></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    <span class="co"># London city issues</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>     <span class="fu">str_detect</span>(institution, <span class="st">"University College London"</span>) <span class="sc">~</span> <span class="st">"London"</span>,</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>     <span class="fu">str_detect</span>(institution, <span class="st">"London, United Kingdom"</span>) <span class="sc">~</span> <span class="st">"London"</span>,</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>     <span class="fu">str_detect</span>(institution, <span class="st">"Grovelands Priory Hospital"</span>) <span class="sc">~</span> <span class="st">"London"</span>,</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Sort Columbia issues:</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Vancouver"</span>) <span class="sc">~</span> <span class="st">"Vancouver"</span>,</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Columbia University"</span>) <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort Colombia issues:</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Bogota"</span>) <span class="sc">~</span> <span class="st">"Bogota"</span>,</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Barranquilla"</span>) <span class="sc">~</span> <span class="st">"Barranquilla"</span>,</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Pasto"</span>) <span class="sc">~</span> <span class="st">"Pasto"</span>,</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Campus Robledo"</span>) <span class="sc">~</span> <span class="st">"Medellin"</span>,</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Cambridge city issues:</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Cambridge University, UCL and NHS National Centre for gaming Disorders"</span>) <span class="sc">~</span> <span class="st">"London"</span>,</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>   <span class="co"># UBC &amp; Canada other:</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"University of British Columbia"</span>) <span class="sc">~</span> <span class="st">"Vancouver"</span>,</span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Toronto, Canada"</span>) <span class="sc">~</span> <span class="st">"Toronto"</span>,</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Department of Education, Centre for Addiction and Mental Health"</span>) <span class="sc">~</span> <span class="st">"Toronto"</span>,</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Morton and Gloria Shulman Movement Disorders Clinic"</span>) <span class="sc">~</span> <span class="st">"Toronto"</span>,</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>          <span class="fu">str_detect</span>(institution, <span class="st">"University of New Brunswick"</span>) <span class="sc">~</span> <span class="st">"Fredericton"</span>,</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Addiction &amp; Mental Health Services-Kingston"</span>) <span class="sc">~</span> <span class="st">"Kingston"</span>,</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Aberdeen issues:</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Hong Kong"</span>) <span class="sc">~</span> <span class="st">"Hong Kong"</span>, <span class="co"># CHECK 312 and lower</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Newport issues:</span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Christopher Newport University"</span>) <span class="sc">~</span> <span class="st">"Newport News"</span>,</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Cyprus:</span></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Karsiyaka"</span>) <span class="sc">~</span> <span class="st">"Karsiyaka"</span>,</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Palo Alto</span></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Palo Alto"</span>) <span class="sc">~</span> <span class="st">"Palo Alto"</span>,</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>   <span class="co"># UWV:</span></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Morgantown"</span>) <span class="sc">~</span> <span class="st">"Morgantown"</span>,</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Marid:</span></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>     <span class="fu">str_detect</span>(institution, <span class="st">"Madrid, Spain"</span>) <span class="sc">~</span> <span class="st">"Madrid"</span>,</span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Paris:</span></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Pole paris 12"</span>) <span class="sc">~</span> <span class="st">"Paris"</span>,</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Paris, France"</span>) <span class="sc">~</span> <span class="st">"Paris"</span>,</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Centre Pierre Nicole"</span>) <span class="sc">~</span> <span class="st">"Paris"</span>,</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"centre hospitalier Sainte-Anne"</span>) <span class="sc">~</span> <span class="st">"Paris"</span>,</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Providence:</span></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(institution, <span class="st">"Brown University"</span>) <span class="sc">~</span> <span class="st">"Providence"</span>,</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># North Kingston, RI, USA</span></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(institution, <span class="st">"North Kingston"</span>) <span class="sc">~</span> <span class="st">"Providence"</span>,</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Essesx uni campus:</span></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"University of Essex, Colchester"</span>) <span class="sc">~</span> <span class="st">"Colchester"</span>,</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Serbia uni &amp; Belgrade:</span></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(institution, <span class="st">"Novi Pazar, Serbia"</span>) <span class="sc">~</span> <span class="st">"Novi Pazar"</span>,</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Belgrade, Serbia"</span>) <span class="sc">~</span> <span class="st">"Belgrade"</span>,</span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Milan:</span></span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Milan, Italy"</span>) <span class="sc">~</span> <span class="st">"Milan"</span>,</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>  <span class="co"># UMissouri:</span></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"University of Missouri"</span>) <span class="sc">~</span> <span class="st">"Columbia"</span>,</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rochester:</span></span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Rochester"</span>) <span class="sc">~</span> <span class="st">"Rochester"</span>,</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bedford, USA:</span></span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Edith Nourse Rogers Memorial Hospital"</span>) <span class="sc">~</span> <span class="st">"Bedford"</span>,</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a><span class="co"># Yale:</span></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"New Haven, CT"</span>) <span class="sc">~</span> <span class="st">"New Haven"</span>,</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Yale University"</span>) <span class="sc">~</span> <span class="st">"New Haven"</span>,</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Auckland &amp; Newzeland:</span></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Auckland"</span>) <span class="sc">~</span> <span class="st">"Auckland"</span>,</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Palmerston North, Manawatu"</span>) <span class="sc">~</span> <span class="st">"Palmerston North"</span>,</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a><span class="co"># Lausanne:</span></span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Lausanne"</span>) <span class="sc">~</span> <span class="st">"Lausanne"</span>,</span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a><span class="co"># Boston issues:</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Boston, MA"</span>) <span class="sc">~</span> <span class="st">"Boston"</span>,</span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Veteran's MH and Addiction Program, VA"</span>) <span class="sc">~</span> <span class="st">"Boston"</span>,</span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Berenson-Allen Center for Noninvasive"</span>) <span class="sc">~</span> <span class="st">"Boston"</span>,</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a><span class="co"># New york:</span></span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Nassau Community College"</span>) <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"St Bonaventure University"</span>) <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Elmhurst Hospital Center"</span>) <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Cure Huntington's Disease Initiative"</span>) <span class="sc">~</span> <span class="st">"New York"</span>,</span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a><span class="co"># Amityville</span></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Amityville"</span>) <span class="sc">~</span> <span class="st">"Amityville"</span>,</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a><span class="co"># German city:</span></span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Villingen-Schwenningen"</span>) <span class="sc">~</span> <span class="st">"Villingen-Schwenningen"</span>,</span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Hurth, Germany"</span>) <span class="sc">~</span> <span class="st">"Hurth"</span>,</span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Martin-Luther-University"</span>) <span class="sc">~</span> <span class="st">"Halle"</span>,</span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Iraninan city:</span></span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Isfahan, Iran"</span>) <span class="sc">~</span> <span class="st">"Isfahan"</span>,</span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a><span class="co"># Israel:</span></span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Kfar-Saba"</span>) <span class="sc">~</span> <span class="st">"Tel Aviv"</span>,</span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Leslie and Susan Gonda"</span>) <span class="sc">~</span> <span class="st">"Tel Aviv"</span>, </span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a><span class="co"># South Korea:</span></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Hanyang University"</span>) <span class="sc">~</span> <span class="st">"Seoul"</span>,</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Chungmugong Leadership Center"</span>) <span class="sc">~</span> <span class="st">"Changwon"</span>,</span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Korea Institute on Behavioral Addictions"</span>) <span class="sc">~</span> <span class="st">"Seoul"</span>,</span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"hallym University"</span>) <span class="sc">~</span> <span class="st">"Anyang"</span>,</span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a><span class="co"># Christiana Care Hospital:  </span></span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Christiana Care Hospital"</span>) <span class="sc">~</span> <span class="st">"Wilmington"</span>, </span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a><span class="co"># Rush University Medical Center:</span></span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Rush University Medical Center"</span>) <span class="sc">~</span> <span class="st">"Chicago"</span>,</span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a> <span class="co"># Jordan city:</span></span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Amman 19392, Jordan"</span>) <span class="sc">~</span> <span class="st">"Amman"</span>, </span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Perth/Aus:</span></span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Perth, Australia"</span>) <span class="sc">~</span> <span class="st">"Perth"</span>, </span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Adelaide"</span>) <span class="sc">~</span> <span class="st">"Adelaide"</span>, </span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">" CQUniversity, 400 Kent St, Sydney"</span>) <span class="sc">~</span> <span class="st">"Sydney"</span>, </span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a><span class="co"># Oxford Uni:</span></span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Oxford, United Kingdom"</span>) <span class="sc">~</span> <span class="st">"Oxford"</span>, </span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a><span class="co"># Salford Uni:</span></span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Frederick Road Campus"</span>) <span class="sc">~</span> <span class="st">"Salford"</span>, </span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a> <span class="co"># Italian cities:</span></span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Portici, Italy"</span>) <span class="sc">~</span> <span class="st">"Naples"</span>, </span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Betania Evangelical Hospital"</span>) <span class="sc">~</span> <span class="st">"Naples"</span>, </span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Genoa, Italy"</span>) <span class="sc">~</span> <span class="st">"Genoa"</span>, </span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Lecco, Italy"</span>) <span class="sc">~</span> <span class="st">"Lecco"</span>, </span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"University of Genova"</span>) <span class="sc">~</span> <span class="st">"Genoa"</span>, </span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Terni, Italy"</span>) <span class="sc">~</span> <span class="st">"Terni"</span>, </span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Telese Terme"</span>) <span class="sc">~</span> <span class="st">"Telese"</span>,</span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Urbino"</span>) <span class="sc">~</span> <span class="st">"Urbino"</span>, </span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Universita Cattolica"</span>) <span class="sc">~</span> <span class="st">"Rome"</span>, </span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"University of Turin, Torino"</span>) <span class="sc">~</span> <span class="st">"Turin"</span>, </span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Alma Mater Studiorum"</span>) <span class="sc">~</span> <span class="st">"Bologna"</span>, </span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a>  <span class="co"># barcelona &amp; other spanish city issues:</span></span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Barcelona, Spain"</span>) <span class="sc">~</span> <span class="st">"Barcelona"</span>,</span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Universitat Rovira i Virgili"</span>) <span class="sc">~</span> <span class="st">"Tarragona"</span>,</span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Alicante, Spain"</span>) <span class="sc">~</span> <span class="st">"Alicante"</span>,</span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Bormujos, Spain"</span>) <span class="sc">~</span> <span class="st">"Bormujos"</span>,</span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Ciencies d'Alimentacio"</span>) <span class="sc">~</span> <span class="st">"Barcelona"</span>,</span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Jimenez Diaz University Hospital"</span>) <span class="sc">~</span> <span class="st">"Mardrid"</span>,</span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Centro Universitario Cardenal Cisneros"</span>) <span class="sc">~</span> <span class="st">"Madrid"</span>, </span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Santiago de Compostela"</span>) <span class="sc">~</span> <span class="st">"Santiago de Compostela"</span>, </span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Consumer and User Psychology Unit, Faculty of Psychology, University of Santiago"</span>) <span class="sc">~</span> <span class="st">"Santiago de Compostela"</span>, </span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Department of Physiology, School of Medicine, University of Santiago de"</span>) <span class="sc">~</span> <span class="st">"Santiago de Compostela"</span>, <span class="co"># Confirmed by searching original paper</span></span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Serra Hunter Programme"</span>) <span class="sc">~</span> <span class="st">"Barcelona"</span>,</span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Hospital Universitario de Canarias"</span>) <span class="sc">~</span> <span class="st">"Santa Cruz de Tenerife"</span>,</span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Universitat Pompeu Fabra"</span>) <span class="sc">~</span> <span class="st">"Barcelona"</span>,</span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Universidad Loyola Andalucia"</span>) <span class="sc">~</span> <span class="st">"Cordoba"</span>,</span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a><span class="co"># Nottingham:</span></span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Newark Beacon Innovation Centre"</span>) <span class="sc">~</span> <span class="st">"Nottingham"</span>,</span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a><span class="co"># Portugal:</span></span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Unity in Multidisciplinary Research on Biomedicine (UMIB)"</span>) <span class="sc">~</span> <span class="st">"Porto"</span>,</span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"IAJ (Gambling Support Institute)"</span>) <span class="sc">~</span> <span class="st">"Lisbon"</span>,</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Porto Alegre issue:</span></span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Porto Alegre"</span>) <span class="sc">~</span> <span class="st">"Porto Alegre"</span>,</span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a><span class="co"># Namur:</span></span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Namur"</span>) <span class="sc">~</span> <span class="st">"Namur"</span>, <span class="co"># Checked there's only one in the data</span></span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a><span class="co"># Sandy bay tas:</span></span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Sandy Bay"</span>) <span class="sc">~</span> <span class="st">"Sandy Bay"</span>,</span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a><span class="co"># Oviedo:</span></span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Oviedo, Spain"</span>) <span class="sc">~</span> <span class="st">"Oviedo"</span>,</span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Virginia Tech, Blacksburg, VA"</span>) <span class="sc">~</span> <span class="st">"Roanoke"</span>,</span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a><span class="co"># Dublin &amp; ireland:</span></span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Lucena Clinic Rathgar"</span>) <span class="sc">~</span> <span class="st">"Dublin"</span>,</span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Dublin, Ireland"</span>) <span class="sc">~</span> <span class="st">"Dublin"</span>,</span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a> <span class="co"># West Chester University:</span></span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"West Chester University"</span>) <span class="sc">~</span> <span class="st">"Philadelphia"</span>,</span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Yunlin, Taiwan:</span></span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Yunlin, Taiwan"</span>) <span class="sc">~</span> <span class="st">"Douliu"</span>,</span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a>    <span class="co"># University of Montana:</span></span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"University of Montana"</span>) <span class="sc">~</span> <span class="st">"Missoula"</span>,</span>
<span id="cb7-238"><a href="#cb7-238" aria-hidden="true" tabindex="-1"></a>      <span class="co"># San Juan:</span></span>
<span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"University of Puerto Rico, San Juan"</span>) <span class="sc">~</span> <span class="st">"San Juan"</span>,</span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Moroccan city:</span></span>
<span id="cb7-241"><a href="#cb7-241" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Fez, Morocco"</span>) <span class="sc">~</span> <span class="st">"Fez"</span>,</span>
<span id="cb7-242"><a href="#cb7-242" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Seton Hall University &amp; other newark issues:</span></span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Seton Hall University"</span>) <span class="sc">~</span> <span class="st">"Newark"</span>,</span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Parsippany, NJ"</span>) <span class="sc">~</span> <span class="st">"Newark"</span>,</span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a><span class="co"># Auburn University:</span></span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Auburn University"</span>) <span class="sc">~</span> <span class="st">"Montgomery"</span>,</span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a><span class="co">#  University of Manitoba:</span></span>
<span id="cb7-248"><a href="#cb7-248" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"University of Manitoba"</span>) <span class="sc">~</span> <span class="st">"Winnipeg"</span>,</span>
<span id="cb7-249"><a href="#cb7-249" aria-hidden="true" tabindex="-1"></a><span class="co"># University of South Dakota:</span></span>
<span id="cb7-250"><a href="#cb7-250" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"University of South Dakota"</span>) <span class="sc">~</span> <span class="st">"Vermillion"</span>,</span>
<span id="cb7-251"><a href="#cb7-251" aria-hidden="true" tabindex="-1"></a><span class="co"># University of Antwerpen:</span></span>
<span id="cb7-252"><a href="#cb7-252" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Institute Born-Bunge"</span>) <span class="sc">~</span> <span class="st">"Antwerp"</span>,</span>
<span id="cb7-253"><a href="#cb7-253" aria-hidden="true" tabindex="-1"></a><span class="co"># University of Kansas:</span></span>
<span id="cb7-254"><a href="#cb7-254" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"University of Kansas"</span>) <span class="sc">~</span> <span class="st">"Lawrence"</span>,</span>
<span id="cb7-255"><a href="#cb7-255" aria-hidden="true" tabindex="-1"></a><span class="co"># Vanderbilt University:</span></span>
<span id="cb7-256"><a href="#cb7-256" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"Vanderbilt"</span>) <span class="sc">~</span> <span class="st">"Nashville"</span>,</span>
<span id="cb7-257"><a href="#cb7-257" aria-hidden="true" tabindex="-1"></a><span class="co"># Wayne state university:</span></span>
<span id="cb7-258"><a href="#cb7-258" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"Wayne State University"</span>) <span class="sc">~</span> <span class="st">"Detroit"</span>,</span>
<span id="cb7-259"><a href="#cb7-259" aria-hidden="true" tabindex="-1"></a><span class="co"># University  Michigan:</span></span>
<span id="cb7-260"><a href="#cb7-260" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"University of Michigan"</span>) <span class="sc">~</span> <span class="st">"Ann Arbor"</span>,</span>
<span id="cb7-261"><a href="#cb7-261" aria-hidden="true" tabindex="-1"></a><span class="co"># Carson College of Business:</span></span>
<span id="cb7-262"><a href="#cb7-262" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"Carson College of Business"</span>) <span class="sc">~</span> <span class="st">"Pullman"</span>,</span>
<span id="cb7-263"><a href="#cb7-263" aria-hidden="true" tabindex="-1"></a><span class="co"># Universidad de San Martin de Porres</span></span>
<span id="cb7-264"><a href="#cb7-264" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"Universidad de San Martin de Porres"</span>) <span class="sc">~</span> <span class="st">"Lima"</span>,</span>
<span id="cb7-265"><a href="#cb7-265" aria-hidden="true" tabindex="-1"></a><span class="co"># The Center for Internet and Technology Addiction</span></span>
<span id="cb7-266"><a href="#cb7-266" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"The Center for Internet and Technology Addiction"</span>) <span class="sc">~</span> <span class="st">"Hartford"</span>,</span>
<span id="cb7-267"><a href="#cb7-267" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Meridian Behavioral Health Services (I can't find a full address for this, despite searching the people manually, But it doesn't appear to be in the US):</span></span>
<span id="cb7-268"><a href="#cb7-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution,  <span class="st">"Meridian Behavioral Health Services"</span>) <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb7-269"><a href="#cb7-269" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Brazilian hospital:</span></span>
<span id="cb7-270"><a href="#cb7-270" aria-hidden="true" tabindex="-1"></a>     <span class="fu">str_detect</span>(institution, <span class="st">"Belo Horizonte"</span>) <span class="sc">~</span> <span class="st">"Brazil"</span>,</span>
<span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Nashville:</span></span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Nashville, TN"</span>) <span class="sc">~</span> <span class="st">"Nashville"</span>,</span>
<span id="cb7-273"><a href="#cb7-273" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fort Lauderdale:</span></span>
<span id="cb7-274"><a href="#cb7-274" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Fort Lauderdale"</span>) <span class="sc">~</span> <span class="st">"Fort Lauderdale"</span>,</span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Byblos Lebanon:</span></span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Byblos, Lebanon"</span>) <span class="sc">~</span> <span class="st">"Byblos"</span>,</span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a> <span class="co"># Belgium city:</span></span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Hasselt, Belgium"</span>) <span class="sc">~</span> <span class="st">"Hasselt"</span>,</span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a><span class="co"># Poland:</span></span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Uniwersytet Jagiellonski Collegium Medicum"</span>) <span class="sc">~</span> <span class="st">"Krakow"</span>,</span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a> <span class="co"># Peru:</span></span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Lima, Peru"</span>) <span class="sc">~</span> <span class="st">"Lima"</span>,</span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a><span class="co">#Japan:</span></span>
<span id="cb7-284"><a href="#cb7-284" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Konan Women's University"</span>) <span class="sc">~</span> <span class="st">"Kobe"</span>,</span>
<span id="cb7-285"><a href="#cb7-285" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Tokai Gakuen University"</span>) <span class="sc">~</span> <span class="st">"Tokai Gakuen University"</span>,</span>
<span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"University of Hokkaido"</span>) <span class="sc">~</span> <span class="st">"Hokkaido"</span>,</span>
<span id="cb7-287"><a href="#cb7-287" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Tama-ku, Kawasaki"</span>) <span class="sc">~</span> <span class="st">"Kawasaki"</span>,</span>
<span id="cb7-288"><a href="#cb7-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-289"><a href="#cb7-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-290"><a href="#cb7-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-291"><a href="#cb7-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Virginia:</span></span>
<span id="cb7-292"><a href="#cb7-292" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Virginia Institute for Psychiatry and Behavioral Genetics"</span>) <span class="sc">~</span> <span class="st">"Richmond"</span>,</span>
<span id="cb7-293"><a href="#cb7-293" aria-hidden="true" tabindex="-1"></a><span class="co"># Kuala Lumpur:</span></span>
<span id="cb7-294"><a href="#cb7-294" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Monash University Malaysia"</span>) <span class="sc">~</span> <span class="st">"Kuala Lumpur"</span>,</span>
<span id="cb7-295"><a href="#cb7-295" aria-hidden="true" tabindex="-1"></a> <span class="co"># Vietnam:</span></span>
<span id="cb7-296"><a href="#cb7-296" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Nguyen Tat Thanh University"</span>) <span class="sc">~</span> <span class="st">"Ho Chi Minh City"</span>,</span>
<span id="cb7-297"><a href="#cb7-297" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Santo AndrÃ©:</span></span>
<span id="cb7-298"><a href="#cb7-298" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Santo Andre, SP, Brazil"</span>) <span class="sc">~</span> <span class="st">"Santo Andre"</span>,</span>
<span id="cb7-299"><a href="#cb7-299" aria-hidden="true" tabindex="-1"></a><span class="co"># author not institution:</span></span>
<span id="cb7-300"><a href="#cb7-300" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Maya Sahu, RN, RM,"</span>) <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb7-301"><a href="#cb7-301" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(cities_of_authors)  <span class="co"># Default if none of the above matches</span></span>
<span id="cb7-302"><a href="#cb7-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-303"><a href="#cb7-303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-304"><a href="#cb7-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-305"><a href="#cb7-305" aria-hidden="true" tabindex="-1"></a> <span class="co"># COUNTRY CHANGES:</span></span>
<span id="cb7-306"><a href="#cb7-306" aria-hidden="true" tabindex="-1"></a> )) <span class="sc">%&gt;%</span></span>
<span id="cb7-307"><a href="#cb7-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">countries_of_authors =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a> <span class="co"># Sort Georgia country issues:</span></span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Georgia State University"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"University of Georgia"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Georgia College"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(cities_of_authors, <span class="st">"Marietta"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mongolia country issues:</span></span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Inner Mongolia"</span>) <span class="sc">~</span> <span class="st">"China"</span>,</span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Mexico Country issues:</span></span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"University of New Mexico"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Germany issues:</span></span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Martin-Luther-University"</span>) <span class="sc">~</span> <span class="st">"Germany"</span>,</span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Jersey country issues:</span></span>
<span id="cb7-320"><a href="#cb7-320" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"New Jersey"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-321"><a href="#cb7-321" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambridge city issues:</span></span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Harvard"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-323"><a href="#cb7-323" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"University of Cambridge"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-324"><a href="#cb7-324" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Cambridge Health Alliance"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-325"><a href="#cb7-325" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Anglia Ruskin University"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Boston issue:</span></span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Boston, MA"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a>  <span class="co"># London city issues</span></span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"London"</span>)  <span class="sc">&amp;</span></span>
<span id="cb7-330"><a href="#cb7-330" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">str_detect</span>(institution, <span class="st">"Ontario"</span>) <span class="sc">&amp;</span></span>
<span id="cb7-331"><a href="#cb7-331" aria-hidden="true" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">str_detect</span>(institution, <span class="st">"Canada"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-332"><a href="#cb7-332" aria-hidden="true" tabindex="-1"></a>     <span class="fu">str_detect</span>(institution, <span class="st">"Ontario"</span>) <span class="sc">~</span> <span class="st">"Canada"</span>,</span>
<span id="cb7-333"><a href="#cb7-333" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort Columbia issues:</span></span>
<span id="cb7-334"><a href="#cb7-334" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-335"><a href="#cb7-335" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"University of British Columbia"</span>) <span class="sc">~</span> <span class="st">"Canada"</span>,</span>
<span id="cb7-336"><a href="#cb7-336" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Columbia University"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-337"><a href="#cb7-337" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"United States of America"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-338"><a href="#cb7-338" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Missouri"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-339"><a href="#cb7-339" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"New York"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-340"><a href="#cb7-340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"British Columbia"</span>) <span class="sc">~</span> <span class="st">"Canada"</span>,</span>
<span id="cb7-341"><a href="#cb7-341" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Chilliwack"</span>) <span class="sc">~</span> <span class="st">"Canada"</span>,</span>
<span id="cb7-342"><a href="#cb7-342" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Centro Universitario Cardenal Cisneros"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>,</span>
<span id="cb7-343"><a href="#cb7-343" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-344"><a href="#cb7-344" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Australia:</span></span>
<span id="cb7-345"><a href="#cb7-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Adelaide"</span>) <span class="sc">~</span> <span class="st">"Australia"</span>,</span>
<span id="cb7-346"><a href="#cb7-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">" CQUniversity, 400 Kent St, Sydney"</span>) <span class="sc">~</span> <span class="st">"Australia"</span>,</span>
<span id="cb7-347"><a href="#cb7-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">" CQUniversity"</span>) <span class="sc">~</span> <span class="st">"Australia"</span>,</span>
<span id="cb7-348"><a href="#cb7-348" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Sort Colombia issues:</span></span>
<span id="cb7-349"><a href="#cb7-349" aria-hidden="true" tabindex="-1"></a>     <span class="fu">str_detect</span>(institution, <span class="st">"Barranquilla"</span>) <span class="sc">~</span> <span class="st">"Colombia"</span>,</span>
<span id="cb7-350"><a href="#cb7-350" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Canada:</span></span>
<span id="cb7-351"><a href="#cb7-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Department of Education, Centre for Addiction and Mental Health"</span>) <span class="sc">~</span> <span class="st">"Canada"</span>,</span>
<span id="cb7-352"><a href="#cb7-352" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(institution, <span class="st">"Morton and Gloria Shulman Movement Disorders Clinic"</span>) <span class="sc">~</span> <span class="st">"Canada"</span>,</span>
<span id="cb7-353"><a href="#cb7-353" aria-hidden="true" tabindex="-1"></a>        <span class="fu">str_detect</span>(institution, <span class="st">"University of New Brunswick"</span>) <span class="sc">~</span> <span class="st">"Canada"</span>,</span>
<span id="cb7-354"><a href="#cb7-354" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Addiction &amp; Mental Health Services-Kingston"</span>) <span class="sc">~</span> <span class="st">"Canada"</span>,</span>
<span id="cb7-355"><a href="#cb7-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Toronto, ON"</span>) <span class="sc">~</span> <span class="st">"Canada"</span>,</span>
<span id="cb7-356"><a href="#cb7-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Social and Economic Impacts of Gambling in Massachusetts project,"</span>) <span class="sc">~</span> <span class="st">"USA"</span>, <span class="co"># Was originally Canada</span></span>
<span id="cb7-357"><a href="#cb7-357" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-358"><a href="#cb7-358" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-359"><a href="#cb7-359" aria-hidden="true" tabindex="-1"></a>  <span class="co"># South Korea:</span></span>
<span id="cb7-360"><a href="#cb7-360" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Hanyang University"</span>) <span class="sc">~</span> <span class="st">"South Korea"</span>,</span>
<span id="cb7-361"><a href="#cb7-361" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Chungmugong Leadership Center"</span>) <span class="sc">~</span> <span class="st">"South Korea"</span>,</span>
<span id="cb7-362"><a href="#cb7-362" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Korea Institute on Behavioral Addictions"</span>) <span class="sc">~</span> <span class="st">"South Korea"</span>,</span>
<span id="cb7-363"><a href="#cb7-363" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"hallym University"</span>) <span class="sc">~</span> <span class="st">"South Korea"</span>,</span>
<span id="cb7-364"><a href="#cb7-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-365"><a href="#cb7-365" aria-hidden="true" tabindex="-1"></a><span class="co"># Portugal:</span></span>
<span id="cb7-366"><a href="#cb7-366" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Unity in Multidisciplinary Research on Biomedicine (UMIB)"</span>) <span class="sc">~</span> <span class="st">"Portugal"</span>,</span>
<span id="cb7-367"><a href="#cb7-367" aria-hidden="true" tabindex="-1"></a>  <span class="co"># China:</span></span>
<span id="cb7-368"><a href="#cb7-368" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"The Chinese University of Hong Kong"</span>) <span class="sc">~</span> <span class="st">"China"</span>,</span>
<span id="cb7-369"><a href="#cb7-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-370"><a href="#cb7-370" aria-hidden="true" tabindex="-1"></a><span class="co"># South Africa:</span></span>
<span id="cb7-371"><a href="#cb7-371" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Christiana Care Hospital"</span>) <span class="sc">~</span> <span class="st">"USA"</span>, </span>
<span id="cb7-372"><a href="#cb7-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-373"><a href="#cb7-373" aria-hidden="true" tabindex="-1"></a><span class="co"># Newark Beacon Innovation Centre:</span></span>
<span id="cb7-374"><a href="#cb7-374" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Newark Beacon Innovation Centre"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort Liverpool issues: </span></span>
<span id="cb7-377"><a href="#cb7-377" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"John Moores"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-378"><a href="#cb7-378" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"University of Liverpool"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-379"><a href="#cb7-379" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"LiMRIC"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-380"><a href="#cb7-380" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Liverpool, England"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-381"><a href="#cb7-381" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Liverpool John"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-382"><a href="#cb7-382" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reading issues:</span></span>
<span id="cb7-383"><a href="#cb7-383" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"University of Reading"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-384"><a href="#cb7-384" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"USA"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"United States"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-386"><a href="#cb7-386" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Northampton issues:</span></span>
<span id="cb7-387"><a href="#cb7-387" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"University of Northampton"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-388"><a href="#cb7-388" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Gemini Research"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-389"><a href="#cb7-389" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Virginia:</span></span>
<span id="cb7-390"><a href="#cb7-390" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Virginia Institute for Psychiatry and Behavioral Genetics"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-391"><a href="#cb7-391" aria-hidden="true" tabindex="-1"></a> <span class="co"># University of Alabama:</span></span>
<span id="cb7-392"><a href="#cb7-392" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"University of Alabama"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-393"><a href="#cb7-393" aria-hidden="true" tabindex="-1"></a><span class="co"># University  Michigan:</span></span>
<span id="cb7-394"><a href="#cb7-394" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"University of Michigan"</span>) <span class="sc">~</span> <span class="st">"USAr"</span>,</span>
<span id="cb7-395"><a href="#cb7-395" aria-hidden="true" tabindex="-1"></a> <span class="co"># The Center for Internet and Technology Addiction</span></span>
<span id="cb7-396"><a href="#cb7-396" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"The Center for Internet and Technology Addiction"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-397"><a href="#cb7-397" aria-hidden="true" tabindex="-1"></a><span class="co">#  University of Southern  California:</span></span>
<span id="cb7-398"><a href="#cb7-398" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"University of Southern California"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-399"><a href="#cb7-399" aria-hidden="true" tabindex="-1"></a><span class="co"># Salford Uni:</span></span>
<span id="cb7-400"><a href="#cb7-400" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Frederick Road Campus"</span>) <span class="sc">~</span> <span class="st">"UK"</span>, </span>
<span id="cb7-401"><a href="#cb7-401" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sterling issues:</span></span>
<span id="cb7-402"><a href="#cb7-402" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Australia"</span>) <span class="sc">~</span> <span class="st">"Australia"</span>,</span>
<span id="cb7-403"><a href="#cb7-403" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Palo Alto</span></span>
<span id="cb7-404"><a href="#cb7-404" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Palo Alto"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-405"><a href="#cb7-405" aria-hidden="true" tabindex="-1"></a>   <span class="co"># Aberdeen issues:</span></span>
<span id="cb7-406"><a href="#cb7-406" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Hong kong"</span>) <span class="sc">~</span> <span class="st">"China"</span>,</span>
<span id="cb7-407"><a href="#cb7-407" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Newport issues:</span></span>
<span id="cb7-408"><a href="#cb7-408" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Christopher Newport University"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-409"><a href="#cb7-409" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Oxford issues:</span></span>
<span id="cb7-410"><a href="#cb7-410" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"University of Oxford"</span>) <span class="sc">~</span> <span class="st">"UK"</span>, </span>
<span id="cb7-411"><a href="#cb7-411" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Oxford, UK"</span>) <span class="sc">~</span> <span class="st">"UK"</span>, </span>
<span id="cb7-412"><a href="#cb7-412" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Oxford Centre for"</span>) <span class="sc">~</span> <span class="st">"UK"</span>,</span>
<span id="cb7-413"><a href="#cb7-413" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Weird barcelona uni &amp; spain issue:</span></span>
<span id="cb7-414"><a href="#cb7-414" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"University of Barcelona, Barcelona"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>,</span>
<span id="cb7-415"><a href="#cb7-415" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_detect</span>(institution, <span class="st">"Jimenez Diaz University Hospital"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>,</span>
<span id="cb7-416"><a href="#cb7-416" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Santiago de Compostela"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>, </span>
<span id="cb7-417"><a href="#cb7-417" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Consumer and User Psychology Unit, Faculty of Psychology, University of Santiago"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>, </span>
<span id="cb7-418"><a href="#cb7-418" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Serra Hunter Programme"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>,</span>
<span id="cb7-419"><a href="#cb7-419" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Hospital Universitario de Canarias"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>,</span>
<span id="cb7-420"><a href="#cb7-420" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Universitat Pompeu Fabra"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>,</span>
<span id="cb7-421"><a href="#cb7-421" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Universidad Loyola Andalucia"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>,</span>
<span id="cb7-422"><a href="#cb7-422" aria-hidden="true" tabindex="-1"></a><span class="co"># Italy:</span></span>
<span id="cb7-423"><a href="#cb7-423" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Urbino"</span>) <span class="sc">~</span> <span class="st">"Italy"</span>, </span>
<span id="cb7-424"><a href="#cb7-424" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Betania Evangelical Hospital"</span>) <span class="sc">~</span> <span class="st">"Italy"</span>, </span>
<span id="cb7-425"><a href="#cb7-425" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"University of Turin, Torino"</span>) <span class="sc">~</span> <span class="st">"Italy"</span>, </span>
<span id="cb7-426"><a href="#cb7-426" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Alma Mater Studiorum"</span>) <span class="sc">~</span> <span class="st">"Italy"</span>, </span>
<span id="cb7-427"><a href="#cb7-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-428"><a href="#cb7-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Brazil:</span></span>
<span id="cb7-429"><a href="#cb7-429" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Porto Alegre"</span>) <span class="sc">~</span> <span class="st">"Brazil"</span>, </span>
<span id="cb7-430"><a href="#cb7-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-431"><a href="#cb7-431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-432"><a href="#cb7-432" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lausanne issues:</span></span>
<span id="cb7-433"><a href="#cb7-433" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Lausanne"</span>) <span class="sc">~</span> <span class="st">"Switzerland"</span>,</span>
<span id="cb7-434"><a href="#cb7-434" aria-hidden="true" tabindex="-1"></a> <span class="co"># West Chester University:</span></span>
<span id="cb7-435"><a href="#cb7-435" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"West Chester University"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-436"><a href="#cb7-436" aria-hidden="true" tabindex="-1"></a><span class="co">#Rede SARAH de Hospitais de Reabilitacao:</span></span>
<span id="cb7-437"><a href="#cb7-437" aria-hidden="true" tabindex="-1"></a>   <span class="fu">str_detect</span>(institution, <span class="st">"Rede SARAH de Hospitais de Reabilitacao"</span>) <span class="sc">~</span> <span class="st">"Brazil"</span>,</span>
<span id="cb7-438"><a href="#cb7-438" aria-hidden="true" tabindex="-1"></a> <span class="co"># Taiwan:</span></span>
<span id="cb7-439"><a href="#cb7-439" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_detect</span>(institution, <span class="st">"Taichung"</span>) <span class="sc">~</span> <span class="st">"Taiwan"</span>,</span>
<span id="cb7-440"><a href="#cb7-440" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Vietnam:</span></span>
<span id="cb7-441"><a href="#cb7-441" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Nguyen Tat Thanh University"</span>) <span class="sc">~</span> <span class="st">"Vietnam"</span>,</span>
<span id="cb7-442"><a href="#cb7-442" aria-hidden="true" tabindex="-1"></a> <span class="co"># Spain:</span></span>
<span id="cb7-443"><a href="#cb7-443" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Ciencies d'Alimentacio"</span>) <span class="sc">~</span> <span class="st">"Spain"</span>,</span>
<span id="cb7-444"><a href="#cb7-444" aria-hidden="true" tabindex="-1"></a><span class="co"># Rush University Medical Center:</span></span>
<span id="cb7-445"><a href="#cb7-445" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Rush University Medical Center"</span>) <span class="sc">~</span> <span class="st">"USA"</span>,</span>
<span id="cb7-446"><a href="#cb7-446" aria-hidden="true" tabindex="-1"></a><span class="co"># Belgium:</span></span>
<span id="cb7-447"><a href="#cb7-447" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Institute Born-Bunge"</span>) <span class="sc">~</span> <span class="st">"Belgium"</span>,</span>
<span id="cb7-448"><a href="#cb7-448" aria-hidden="true" tabindex="-1"></a><span class="co"># Peru:</span></span>
<span id="cb7-449"><a href="#cb7-449" aria-hidden="true" tabindex="-1"></a><span class="co"># Universidad de San Martin de Porres</span></span>
<span id="cb7-450"><a href="#cb7-450" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution,  <span class="st">"Universidad de San Martin de Porres"</span>) <span class="sc">~</span> <span class="st">"Peru"</span>,</span>
<span id="cb7-451"><a href="#cb7-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Israel:</span></span>
<span id="cb7-452"><a href="#cb7-452" aria-hidden="true" tabindex="-1"></a> <span class="fu">str_detect</span>(institution, <span class="st">"Beit-Berl College"</span>) <span class="sc">~</span> <span class="st">"Israel"</span>,</span>
<span id="cb7-453"><a href="#cb7-453" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Leslie and Susan Gonda"</span>) <span class="sc">~</span> <span class="st">"Israel"</span>,</span>
<span id="cb7-454"><a href="#cb7-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-455"><a href="#cb7-455" aria-hidden="true" tabindex="-1"></a><span class="co"># author not institution:</span></span>
<span id="cb7-456"><a href="#cb7-456" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(institution, <span class="st">"Maya Sahu, RN, RM,"</span>) <span class="sc">~</span> <span class="st">""</span>,</span>
<span id="cb7-457"><a href="#cb7-457" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">as.character</span>(countries_of_authors)  <span class="co"># Default if none of the above matches</span></span>
<span id="cb7-458"><a href="#cb7-458" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb7-459"><a href="#cb7-459" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb7-460"><a href="#cb7-460" aria-hidden="true" tabindex="-1"></a><span class="co"># Now look to see what's left and see if it matters now if we assume our created city and country names are correct and the link is an error:</span></span>
<span id="cb7-461"><a href="#cb7-461" aria-hidden="true" tabindex="-1"></a> data_locations_with_full_geo_location_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb7-462"><a href="#cb7-462" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(countries_of_authors <span class="sc">!=</span> country.etc) <span class="sc">%&gt;%</span> <span class="co"># Identify and isolate mismatches</span></span>
<span id="cb7-463"><a href="#cb7-463" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(institution,</span>
<span id="cb7-464"><a href="#cb7-464" aria-hidden="true" tabindex="-1"></a>       author_names,</span>
<span id="cb7-465"><a href="#cb7-465" aria-hidden="true" tabindex="-1"></a>         cities_of_authors,</span>
<span id="cb7-466"><a href="#cb7-466" aria-hidden="true" tabindex="-1"></a>         countries_of_authors,</span>
<span id="cb7-467"><a href="#cb7-467" aria-hidden="true" tabindex="-1"></a>       country.etc) <span class="sc">%&gt;%</span></span>
<span id="cb7-468"><a href="#cb7-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">340</span>) <span class="co"># Okay, happy theses are good (after 10+ rounds of filtering)</span></span>
<span id="cb7-469"><a href="#cb7-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-470"><a href="#cb7-470" aria-hidden="true" tabindex="-1"></a><span class="co"># Now look at papers where we couldn't country now look at countries where we couldn't match the country but linking the world.cities dataset connects a country with a city. Error check this:</span></span>
<span id="cb7-471"><a href="#cb7-471" aria-hidden="true" tabindex="-1"></a>  data_locations_with_full_geo_location_cleaned <span class="sc">%&gt;%</span> </span>
<span id="cb7-472"><a href="#cb7-472" aria-hidden="true" tabindex="-1"></a> <span class="fu">filter</span>(<span class="fu">is.na</span>(countries_of_authors) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(country.etc)) <span class="sc">%&gt;%</span> <span class="co"># Identify and isolate these instances</span></span>
<span id="cb7-473"><a href="#cb7-473" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Filter defined only unique instances to save time: </span></span>
<span id="cb7-474"><a href="#cb7-474" aria-hidden="true" tabindex="-1"></a>     <span class="fu">distinct</span>(cities_of_authors, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>)  <span class="sc">%&gt;%</span> </span>
<span id="cb7-475"><a href="#cb7-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(institution,</span>
<span id="cb7-476"><a href="#cb7-476" aria-hidden="true" tabindex="-1"></a>         cities_of_authors,</span>
<span id="cb7-477"><a href="#cb7-477" aria-hidden="true" tabindex="-1"></a>         countries_of_authors,</span>
<span id="cb7-478"><a href="#cb7-478" aria-hidden="true" tabindex="-1"></a>       country.etc) <span class="sc">%&gt;%</span></span>
<span id="cb7-479"><a href="#cb7-479" aria-hidden="true" tabindex="-1"></a>    <span class="co"># View()</span></span>
<span id="cb7-480"><a href="#cb7-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">340</span>) </span>
<span id="cb7-481"><a href="#cb7-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-482"><a href="#cb7-482" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-483"><a href="#cb7-483" aria-hidden="true" tabindex="-1"></a> <span class="co"># data_locations_with_full_geo_location_cleaned %&gt;% </span></span>
<span id="cb7-484"><a href="#cb7-484" aria-hidden="true" tabindex="-1"></a><span class="co">#    filter(str_detect(institution, "arson College of Business")</span></span>
<span id="cb7-485"><a href="#cb7-485" aria-hidden="true" tabindex="-1"></a> <span class="co">#          ) %&gt;% </span></span>
<span id="cb7-486"><a href="#cb7-486" aria-hidden="true" tabindex="-1"></a>    <span class="co"># View()</span></span>
<span id="cb7-487"><a href="#cb7-487" aria-hidden="true" tabindex="-1"></a><span class="co"># Okay,  I've gone back to the above recording section to correct any country mismatches found in the above output:</span></span>
<span id="cb7-488"><a href="#cb7-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-489"><a href="#cb7-489" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-490"><a href="#cb7-490" aria-hidden="true" tabindex="-1"></a><span class="co"># need to try and linkj long and lat to the combination of city and country where possible</span></span>
<span id="cb7-491"><a href="#cb7-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-492"><a href="#cb7-492" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb7-493"><a href="#cb7-493" aria-hidden="true" tabindex="-1"></a> <span class="co"># MAKE GIT FILE SMALLER FOR STORAGE</span></span>
<span id="cb7-494"><a href="#cb7-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-495"><a href="#cb7-495" aria-hidden="true" tabindex="-1"></a> <span class="co"># Other problematic  Cities we need to directly code:</span></span>
<span id="cb7-496"><a href="#cb7-496" aria-hidden="true" tabindex="-1"></a> <span class="co"># Athens</span></span>
<span id="cb7-497"><a href="#cb7-497" aria-hidden="true" tabindex="-1"></a> <span class="co"># Nottingham</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<details>
<summary>Code: Create interactive map of papers</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load world map data but filter out Antarctica as we don't have any values/papers for this region and it just takes up space on the map:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>world_map <span class="ot">&lt;-</span> <span class="fu">map_data</span>(<span class="st">"world"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">!=</span> <span class="st">"Antarctica"</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Join the world map data with our paper data:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>data_locations_with_full_geo_location_WORLD<span class="ot">&lt;-</span> <span class="fu">left_join</span>(data_locations_with_full_geo_location_cleaned, world_map) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Tidy the behavioural addiction labels:</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Label =</span> <span class="fu">str_replace_all</span>(Label, <span class="st">"_"</span>, <span class="st">" "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">str_to_title</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(lat, long)`</code></pre>
</div>
<details>
<summary>Code: Create interactive map of papers</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrangle data for plot:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>data_locations_with_full_geo_location_WORLD_city_aggregate<span class="ot">&lt;-</span> data_locations_with_full_geo_location_WORLD <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the unique number of papers that can be linked to each city:</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>   <span class="fu">group_by</span>(cities_of_authors) <span class="sc">%&gt;%</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_papers =</span> <span class="fu">n_distinct</span>(PMID),</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">lat =</span> <span class="fu">first</span>(lat),   <span class="co"># Retain the first value of latitude for the city</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">long =</span> <span class="fu">first</span>(long),  <span class="co"># Retain the first value of longitude for the city</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">group =</span> <span class="fu">first</span>(group) <span class="co"># Retain the group value from the world map dataset</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(cities_of_authors)) <span class="sc">%&gt;%</span> <span class="co"># Remove rows where we don't have a city</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(<span class="fu">desc</span>(num_papers)) <span class="sc">%&gt;%</span>    <span class="co"># Just for easier viewing</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="co">#  Doing this usually prevents issues later on!</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># It takes quite a long time to produce the interactive plot, so instead of waiting each time I run this script I'm just loading in the version I created earlier. Comment out all of the code below to create the plot.</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create plot:</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a><span class="co"># all_publications_map &lt;- ggplot(world_map, aes(x = long, y = lat, group = group)) +</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_polygon(fill="#289998", colour = "#289998") +</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="co">#    geom_point(data = data_locations_with_full_geo_location_WORLD_city_aggregate,</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a><span class="co">#               aes(x = long, y = lat,</span></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co">#             #  size = sqrt(num_papers),</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co">#               size = num_papers,</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="co">#               text = paste("City:", cities_of_authors, "\nNo. of publications:", num_papers)),</span></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="co">#               colour = "#50B5C8",</span></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co">#               fill = "#F5F7F0",</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a><span class="co">#               alpha = 1,</span></span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a><span class="co">#               shape = 21) +  # Use shape 21 for filled circles</span></span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_size_continuous(guide="none") +</span></span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(expand = c(.001, .001)) +</span></span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a><span class="co">#   # scale_y_continuous(expand = c(.001, .001)) +</span></span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot_theme +</span></span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.text = element_blank(),</span></span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.title = element_blank()) +</span></span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "Institutions of authors publishing behavioural addictions research",</span></span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a><span class="co">#     subtitle = "Each circle represents a city and its size corresponds to the number of papers can be linked to it",</span></span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Rob Heirene (@rheirene)"</span></span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a><span class="co"># # Save this now as a basic plot:</span></span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a><span class="co"># ggsave("posts/2023-history-of-behavioural-addictions-PubMed-part2/all_publications_map.svg",</span></span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a><span class="co">#        plot = all_publications_map,</span></span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a><span class="co">#        width = 9,</span></span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a><span class="co">#        height = 6,</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a><span class="co">#        dpi = 600)</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="co"># # We're going to turn this into an interactive plot now using ggplotly, but this removes some of our existing theme settings, especially the fonts. The standard way of changing the font in ggplotly doesn't seem to work for me, and it seems like other people having the same issue. I found this workaround online (https://github.com/plotly/plotly.R/issues/2117) which I now use below to load and use the correct font once this becomes a ggplotly:</span></span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get the URL for the "Reem Kufi" font from Google Fonts:</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co"># reem_kufi_file &lt;- showtextdb::google_fonts("Reem Kufi")$regular_url</span></span>
<span id="cb10-55"><a href="#cb10-55" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-56"><a href="#cb10-56" aria-hidden="true" tabindex="-1"></a><span class="co"># # Create custom CSS:</span></span>
<span id="cb10-57"><a href="#cb10-57" aria-hidden="true" tabindex="-1"></a><span class="co"># reem_kufi_css &lt;- paste0(</span></span>
<span id="cb10-58"><a href="#cb10-58" aria-hidden="true" tabindex="-1"></a><span class="co">#   "&lt;style type = 'text/css'&gt;",</span></span>
<span id="cb10-59"><a href="#cb10-59" aria-hidden="true" tabindex="-1"></a><span class="co">#     "@font-face { ",</span></span>
<span id="cb10-60"><a href="#cb10-60" aria-hidden="true" tabindex="-1"></a><span class="co">#       "font-family: 'Reem Kufi'; ",</span></span>
<span id="cb10-61"><a href="#cb10-61" aria-hidden="true" tabindex="-1"></a><span class="co">#       "src: url('", reem_kufi_file, "'); ",</span></span>
<span id="cb10-62"><a href="#cb10-62" aria-hidden="true" tabindex="-1"></a><span class="co">#     "}",</span></span>
<span id="cb10-63"><a href="#cb10-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   "&lt;/style&gt;"</span></span>
<span id="cb10-64"><a href="#cb10-64" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb10-65"><a href="#cb10-65" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-66"><a href="#cb10-66" aria-hidden="true" tabindex="-1"></a><span class="co"># # Convert static plot to ggplotly format and adjust theme settings where required:</span></span>
<span id="cb10-67"><a href="#cb10-67" aria-hidden="true" tabindex="-1"></a><span class="co">#  all_publications_map_ggplotly &lt;-ggplotly(all_publications_map,</span></span>
<span id="cb10-68"><a href="#cb10-68" aria-hidden="true" tabindex="-1"></a><span class="co">#                                               tooltip = 'text') %&gt;%</span></span>
<span id="cb10-69"><a href="#cb10-69" aria-hidden="true" tabindex="-1"></a><span class="co">#   hide_legend() %&gt;%</span></span>
<span id="cb10-70"><a href="#cb10-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   plotly::layout(annotations =</span></span>
<span id="cb10-71"><a href="#cb10-71" aria-hidden="true" tabindex="-1"></a><span class="co">#  list(x = 1, y = -0.1, text = "Rob Heirene (@rheirene)",</span></span>
<span id="cb10-72"><a href="#cb10-72" aria-hidden="true" tabindex="-1"></a><span class="co">#       showarrow = F, xref='paper', yref='paper',</span></span>
<span id="cb10-73"><a href="#cb10-73" aria-hidden="true" tabindex="-1"></a><span class="co">#       xanchor='right', yanchor='auto', xshift=0, yshift=25,</span></span>
<span id="cb10-74"><a href="#cb10-74" aria-hidden="true" tabindex="-1"></a><span class="co">#       font=list(size=12, color="#50B5C8")),</span></span>
<span id="cb10-75"><a href="#cb10-75" aria-hidden="true" tabindex="-1"></a><span class="co">#        margin = list(t = 70), # Increase top margin</span></span>
<span id="cb10-76"><a href="#cb10-76" aria-hidden="true" tabindex="-1"></a><span class="co">#                  font = list(family = "Reem Kufi"),</span></span>
<span id="cb10-77"><a href="#cb10-77" aria-hidden="true" tabindex="-1"></a><span class="co">#                  title = list(x = 0, y = 0.945),</span></span>
<span id="cb10-78"><a href="#cb10-78" aria-hidden="true" tabindex="-1"></a><span class="co">#     hoverlabel = list(font = list(family = "Reem Kufi")</span></span>
<span id="cb10-79"><a href="#cb10-79" aria-hidden="true" tabindex="-1"></a><span class="co"># ))</span></span>
<span id="cb10-80"><a href="#cb10-80" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-81"><a href="#cb10-81" aria-hidden="true" tabindex="-1"></a><span class="co"># # Add the CSS as a dependency for the plotly plot:</span></span>
<span id="cb10-82"><a href="#cb10-82" aria-hidden="true" tabindex="-1"></a><span class="co"># all_publications_map_ggplotly$dependencies &lt;- c(</span></span>
<span id="cb10-83"><a href="#cb10-83" aria-hidden="true" tabindex="-1"></a><span class="co">#   all_publications_map_ggplotly$dependencies,</span></span>
<span id="cb10-84"><a href="#cb10-84" aria-hidden="true" tabindex="-1"></a><span class="co">#   list(</span></span>
<span id="cb10-85"><a href="#cb10-85" aria-hidden="true" tabindex="-1"></a><span class="co">#     htmltools::htmlDependency(</span></span>
<span id="cb10-86"><a href="#cb10-86" aria-hidden="true" tabindex="-1"></a><span class="co">#       name = "reem-kufi-font",</span></span>
<span id="cb10-87"><a href="#cb10-87" aria-hidden="true" tabindex="-1"></a><span class="co">#       version = "0",</span></span>
<span id="cb10-88"><a href="#cb10-88" aria-hidden="true" tabindex="-1"></a><span class="co">#       src = "",</span></span>
<span id="cb10-89"><a href="#cb10-89" aria-hidden="true" tabindex="-1"></a><span class="co">#       head = reem_kufi_css)))</span></span>
<span id="cb10-90"><a href="#cb10-90" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-91"><a href="#cb10-91" aria-hidden="true" tabindex="-1"></a><span class="co"># # Display plot:</span></span>
<span id="cb10-92"><a href="#cb10-92" aria-hidden="true" tabindex="-1"></a><span class="co"># saveWidget(all_publications_map_ggplotly, 'posts/2023-history-of-behavioural-addictions-PubMed-part2/all_pubs_map.html')</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<iframe src="all_pubs_map.html" class="fade-inhtml" width="100%" height="600" style="border:none;"></iframe>
<p>Well, that looks nice. I used the <code>ggplotly</code> package to make the map interactive so you can zoom into any area and hover over the circles to see which city is represented and how many papers can be linked to it.</p>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Spot an error in the map?
</div>
</div>
<div class="callout-body-container callout-body">
<p>Trying to match city names to author institutions listed in the data has taught me that there are a lot of duplicated/triplicated/quadruplicated (not sure if thatâ€™s even a word) city names throughout the world. This sometimes means that the author institutions were linked to the wrong city when I first ran this. Iâ€™ve tried to fix all of these errors (some manually, some using some quick workarounds), but if you spot an error like this then please do let me know!</p>
</div>
</div>
<p>L</p>
<div class="cell" data-layout-align="center">
<details>
<summary>Code: Create animated map of papers</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It takes quite a long time to produce the animated plot, so instead of waiting each time I run this script I'm just loading in the version I created earlier. Comment all of the code below to Cceate the plot.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # Wrangle data for plot:</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># data_locations_with_full_geo_location_WORLD_city_label_aggregate&lt;- data_locations_with_full_geo_location_WORLD %&gt;%</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">#  left_join(world_map) %&gt;%</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#    # Calculate the unique number of papers PER ADDICTION that can be linked to each city:</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">#    group_by(cities_of_authors,Label) %&gt;%</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">#     num_papers = n_distinct(PMID),</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co">#     lat = first(lat),   # Retain the first value of latitude for the city</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     long = first(long),  # Retain the first value of longitude for the city</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     group = first(group) # Retain the group value from the world map dataset</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) %&gt;%</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(!is.na(cities_of_authors)) %&gt;% # Remove rows where we can't get the city</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">#     arrange(desc(num_papers)) %&gt;%  # Just for easier viewing</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a><span class="co">#    # Tidy the behavioural addiction labels:</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(Label = str_replace_all(Label, "_", " ") %&gt;%</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                  str_to_title()) %&gt;%</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Add Categories for behavioural addictions:</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(labels_filter = case_when(Label == "Gambling" ~ "Gambling addiction",</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Gaming" ~ "Gaming addiction",</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Smart Phone" ~ "Smart Phone addiction",</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Exercise" ~ "Exercise addiction",</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Social Media" ~ "Social Media addiction",</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Tanning" |</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Selfie" |</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Crime" |</span></span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Dance" |</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Joyriding" |</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Polysurgical" |</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Death" |</span></span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="co">#                                          Label == "Near Death" |</span></span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a><span class="co">#                                          Label == "Fortune Telling" |</span></span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a><span class="co">#                                          Label == "Love"</span></span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a><span class="co">#                                          ~ "The more obscure \"addiction\"",</span></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        TRUE ~ "REMOVE")) %&gt;%</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a><span class="co">#   filter(labels_filter != "REMOVE")  %&gt;%</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(labels_filter = as.factor(labels_filter)) %&gt;%</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a><span class="co"># # Now we need to create descriptive labels to appear with each addiction:</span></span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a><span class="co"># # Before proceeding, let's create a simple dataset to use that contains our  behavioural addiction categories that we can use for grouping:</span></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a><span class="co"># location_grouping_data&lt;- data_locations_with_full_geo_location_WORLD %&gt;% # We need to use the earlier dataset and recreate our grouping labels, as in the dataset we created above we removed papers we couldn't locate them/ get a city</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Add Categories for behavioural addictions:</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a><span class="co">#     mutate(labels_filter = case_when(Label == "Gambling" ~ "Gambling addiction",</span></span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Gaming" ~ "Gaming addiction",</span></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Smart Phone" ~ "Smart Phone addiction",</span></span>
<span id="cb11-52"><a href="#cb11-52" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Exercise" ~ "Exercise addiction",</span></span>
<span id="cb11-53"><a href="#cb11-53" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Social Media" ~ "Social Media addiction",</span></span>
<span id="cb11-54"><a href="#cb11-54" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Tanning" |</span></span>
<span id="cb11-55"><a href="#cb11-55" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Selfie" |</span></span>
<span id="cb11-56"><a href="#cb11-56" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Crime" |</span></span>
<span id="cb11-57"><a href="#cb11-57" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Dance" |</span></span>
<span id="cb11-58"><a href="#cb11-58" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Joyriding" |</span></span>
<span id="cb11-59"><a href="#cb11-59" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Polysurgical" |</span></span>
<span id="cb11-60"><a href="#cb11-60" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        Label == "Death" |</span></span>
<span id="cb11-61"><a href="#cb11-61" aria-hidden="true" tabindex="-1"></a><span class="co">#                                          Label == "Near Death" |</span></span>
<span id="cb11-62"><a href="#cb11-62" aria-hidden="true" tabindex="-1"></a><span class="co">#                                          Label == "Fortune Telling" |</span></span>
<span id="cb11-63"><a href="#cb11-63" aria-hidden="true" tabindex="-1"></a><span class="co">#                                          Label == "Love"</span></span>
<span id="cb11-64"><a href="#cb11-64" aria-hidden="true" tabindex="-1"></a><span class="co">#                                          ~ "The more obscure \"addictions\"",</span></span>
<span id="cb11-65"><a href="#cb11-65" aria-hidden="true" tabindex="-1"></a><span class="co">#                                        TRUE ~ "REMOVE"))</span></span>
<span id="cb11-66"><a href="#cb11-66" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-67"><a href="#cb11-67" aria-hidden="true" tabindex="-1"></a><span class="co"># # First create a dataset that tells us the number of **papers per addiction**:</span></span>
<span id="cb11-68"><a href="#cb11-68" aria-hidden="true" tabindex="-1"></a><span class="co"># location_grouping_data %&gt;%</span></span>
<span id="cb11-69"><a href="#cb11-69" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(labels_filter) %&gt;% </span></span>
<span id="cb11-70"><a href="#cb11-70" aria-hidden="true" tabindex="-1"></a><span class="co">#   summarise(</span></span>
<span id="cb11-71"><a href="#cb11-71" aria-hidden="true" tabindex="-1"></a><span class="co">#     papers_per_addiction = n_distinct(PMID),</span></span>
<span id="cb11-72"><a href="#cb11-72" aria-hidden="true" tabindex="-1"></a><span class="co">#     cities_per_addiction = n_distinct(cities_of_authors),</span></span>
<span id="cb11-73"><a href="#cb11-73" aria-hidden="true" tabindex="-1"></a><span class="co">#     countries_per_addiction = n_distinct(country.etc)</span></span>
<span id="cb11-74"><a href="#cb11-74" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) %&gt;%</span></span>
<span id="cb11-75"><a href="#cb11-75" aria-hidden="true" tabindex="-1"></a><span class="co">#  mutate(description = paste(papers_per_addiction, "unique papers"</span></span>
<span id="cb11-76"><a href="#cb11-76" aria-hidden="true" tabindex="-1"></a><span class="co">#                                 ))</span></span>
<span id="cb11-77"><a href="#cb11-77" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-78"><a href="#cb11-78" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-79"><a href="#cb11-79" aria-hidden="true" tabindex="-1"></a><span class="co">#    mutate(gambling_addiction = case_when(labels_filter == "Gambling addiction" ~ sprintf("1961  \nFirst available study: \n\"Compulsive gambling\""),</span></span>
<span id="cb11-80"><a href="#cb11-80" aria-hidden="true" tabindex="-1"></a><span class="co">#                                TRUE ~ "")) %&gt;%</span></span>
<span id="cb11-81"><a href="#cb11-81" aria-hidden="true" tabindex="-1"></a><span class="co">#     </span></span>
<span id="cb11-82"><a href="#cb11-82" aria-hidden="true" tabindex="-1"></a><span class="co">#      </span></span>
<span id="cb11-83"><a href="#cb11-83" aria-hidden="true" tabindex="-1"></a><span class="co"># # Get palette colors:</span></span>
<span id="cb11-84"><a href="#cb11-84" aria-hidden="true" tabindex="-1"></a><span class="co"># num_labels &lt;- length(unique(data_locations_with_full_geo_location_WORLD_city_label_aggregate$labels_filter))</span></span>
<span id="cb11-85"><a href="#cb11-85" aria-hidden="true" tabindex="-1"></a><span class="co"># palette</span></span>
<span id="cb11-86"><a href="#cb11-86" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-87"><a href="#cb11-87" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-88"><a href="#cb11-88" aria-hidden="true" tabindex="-1"></a><span class="co"># colors_viridis&lt;- viridis(n = length(unique(data_locations_with_full_geo_location_WORLD_city_label_aggregate$labels_filter)), option = "plasma", direction = -1)</span></span>
<span id="cb11-89"><a href="#cb11-89" aria-hidden="true" tabindex="-1"></a><span class="co">#           </span></span>
<span id="cb11-90"><a href="#cb11-90" aria-hidden="true" tabindex="-1"></a><span class="co"># labels&lt;- unique(data_locations_with_full_geo_location_WORLD_city_label_aggregate$labels_filter)</span></span>
<span id="cb11-91"><a href="#cb11-91" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-92"><a href="#cb11-92" aria-hidden="true" tabindex="-1"></a><span class="co"># color_map_df &lt;- tibble(</span></span>
<span id="cb11-93"><a href="#cb11-93" aria-hidden="true" tabindex="-1"></a><span class="co">#   label = labels,</span></span>
<span id="cb11-94"><a href="#cb11-94" aria-hidden="true" tabindex="-1"></a><span class="co">#   color = colors_viridis</span></span>
<span id="cb11-95"><a href="#cb11-95" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb11-96"><a href="#cb11-96" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-97"><a href="#cb11-97" aria-hidden="true" tabindex="-1"></a><span class="co"># color_map &lt;- setNames(color_map_df$color, color_map_df$label)</span></span>
<span id="cb11-98"><a href="#cb11-98" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-99"><a href="#cb11-99" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-100"><a href="#cb11-100" aria-hidden="true" tabindex="-1"></a><span class="co"># # Plot data:</span></span>
<span id="cb11-101"><a href="#cb11-101" aria-hidden="true" tabindex="-1"></a><span class="co"># filtered_publications_map &lt;- ggplot(world_map, aes(x = long, y = lat, group = group)) +</span></span>
<span id="cb11-102"><a href="#cb11-102" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_polygon(fill = "#289998", colour = "#289998") +</span></span>
<span id="cb11-103"><a href="#cb11-103" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = data_locations_with_full_geo_location_WORLD_city_label_aggregate,</span></span>
<span id="cb11-104"><a href="#cb11-104" aria-hidden="true" tabindex="-1"></a><span class="co">#              aes(x = long, y = lat,</span></span>
<span id="cb11-105"><a href="#cb11-105" aria-hidden="true" tabindex="-1"></a><span class="co">#                  size = sqrt(num_papers),</span></span>
<span id="cb11-106"><a href="#cb11-106" aria-hidden="true" tabindex="-1"></a><span class="co">#                   colour = labels_filter,</span></span>
<span id="cb11-107"><a href="#cb11-107" aria-hidden="true" tabindex="-1"></a><span class="co">#                  fill = labels_filter),</span></span>
<span id="cb11-108"><a href="#cb11-108" aria-hidden="true" tabindex="-1"></a><span class="co">#              alpha = 1,</span></span>
<span id="cb11-109"><a href="#cb11-109" aria-hidden="true" tabindex="-1"></a><span class="co">#              shape = 21) +</span></span>
<span id="cb11-110"><a href="#cb11-110" aria-hidden="true" tabindex="-1"></a><span class="co">#   # Removal guides</span></span>
<span id="cb11-111"><a href="#cb11-111" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_size_continuous(guide = "none") +</span></span>
<span id="cb11-112"><a href="#cb11-112" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_viridis(discrete = TRUE, option = "plasma", guide = FALSE, direction = -1)+</span></span>
<span id="cb11-113"><a href="#cb11-113" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_fill_viridis(discrete = TRUE, option = "plasma", guide = FALSE, direction = -1) +</span></span>
<span id="cb11-114"><a href="#cb11-114" aria-hidden="true" tabindex="-1"></a><span class="co">#   # scale_fill_manual(values = palette_colors, guide = FALSE) +</span></span>
<span id="cb11-115"><a href="#cb11-115" aria-hidden="true" tabindex="-1"></a><span class="co">#   # scale_color_manual(values = palette_colors,</span></span>
<span id="cb11-116"><a href="#cb11-116" aria-hidden="true" tabindex="-1"></a><span class="co">#   #                       # rep("#F5F7F0",num_labels),</span></span>
<span id="cb11-117"><a href="#cb11-117" aria-hidden="true" tabindex="-1"></a><span class="co">#   #                     guide = FALSE) +</span></span>
<span id="cb11-118"><a href="#cb11-118" aria-hidden="true" tabindex="-1"></a><span class="co">#   # guides(fill = "none", color = "none") +</span></span>
<span id="cb11-119"><a href="#cb11-119" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_x_continuous(expand = c(0.001, 0.001)) +</span></span>
<span id="cb11-120"><a href="#cb11-120" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous(expand = c(0.001, 0.001)) +</span></span>
<span id="cb11-121"><a href="#cb11-121" aria-hidden="true" tabindex="-1"></a><span class="co">#   plot_theme +</span></span>
<span id="cb11-122"><a href="#cb11-122" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb11-123"><a href="#cb11-123" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.text = element_blank(),</span></span>
<span id="cb11-124"><a href="#cb11-124" aria-hidden="true" tabindex="-1"></a><span class="co">#     axis.title = element_blank(),</span></span>
<span id="cb11-125"><a href="#cb11-125" aria-hidden="true" tabindex="-1"></a><span class="co">#      plot.title = element_text(margin = margin(b = 20))</span></span>
<span id="cb11-126"><a href="#cb11-126" aria-hidden="true" tabindex="-1"></a><span class="co">#     ) +</span></span>
<span id="cb11-127"><a href="#cb11-127" aria-hidden="true" tabindex="-1"></a><span class="co">#   labs(</span></span>
<span id="cb11-128"><a href="#cb11-128" aria-hidden="true" tabindex="-1"></a><span class="co">#     title = "{closest_state} papers",</span></span>
<span id="cb11-129"><a href="#cb11-129" aria-hidden="true" tabindex="-1"></a><span class="co">#     caption = "Rob Heirene (@rheirene)"</span></span>
<span id="cb11-130"><a href="#cb11-130" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb11-131"><a href="#cb11-131" aria-hidden="true" tabindex="-1"></a><span class="co">#   transition_states( </span><span class="al">###</span><span class="co"> NOT FILTER!</span></span>
<span id="cb11-132"><a href="#cb11-132" aria-hidden="true" tabindex="-1"></a><span class="co">#      labels_filter,</span></span>
<span id="cb11-133"><a href="#cb11-133" aria-hidden="true" tabindex="-1"></a><span class="co">#      transition_length = 2,</span></span>
<span id="cb11-134"><a href="#cb11-134" aria-hidden="true" tabindex="-1"></a><span class="co">#      state_length = 6,</span></span>
<span id="cb11-135"><a href="#cb11-135" aria-hidden="true" tabindex="-1"></a><span class="co">#      wrap = FALSE</span></span>
<span id="cb11-136"><a href="#cb11-136" aria-hidden="true" tabindex="-1"></a><span class="co">#    ) +</span></span>
<span id="cb11-137"><a href="#cb11-137" aria-hidden="true" tabindex="-1"></a><span class="co">#   enter_fade() +</span></span>
<span id="cb11-138"><a href="#cb11-138" aria-hidden="true" tabindex="-1"></a><span class="co">#   exit_fade()</span></span>
<span id="cb11-139"><a href="#cb11-139" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-140"><a href="#cb11-140" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-141"><a href="#cb11-141" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-142"><a href="#cb11-142" aria-hidden="true" tabindex="-1"></a><span class="co"># # Animate plot in GIF format:</span></span>
<span id="cb11-143"><a href="#cb11-143" aria-hidden="true" tabindex="-1"></a><span class="co"># animate(filtered_publications_map,</span></span>
<span id="cb11-144"><a href="#cb11-144" aria-hidden="true" tabindex="-1"></a><span class="co">#         fps = 20,</span></span>
<span id="cb11-145"><a href="#cb11-145" aria-hidden="true" tabindex="-1"></a><span class="co">#         end_pause = 70,</span></span>
<span id="cb11-146"><a href="#cb11-146" aria-hidden="true" tabindex="-1"></a><span class="co">#         duration = 30,</span></span>
<span id="cb11-147"><a href="#cb11-147" aria-hidden="true" tabindex="-1"></a><span class="co">#         width = 800, height = 540,</span></span>
<span id="cb11-148"><a href="#cb11-148" aria-hidden="true" tabindex="-1"></a><span class="co">#         type = "cairo")</span></span>
<span id="cb11-149"><a href="#cb11-149" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb11-150"><a href="#cb11-150" aria-hidden="true" tabindex="-1"></a><span class="co"># # The more obscure addictions referred to include turning, selfie, crime, dance, joyriding, polysurgical,  death, near death, fortune telling, and love addictions.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="filtered_publications_map.gif" class="img-fluid figure-img"></p>
</figure>
</div>
</section>
<section id="where-are-these-published" class="level3">
<h3 class="anchored" data-anchor-id="where-are-these-published">Where are these published?</h3>
<div class="cell" data-layout-align="center">
<details>
<summary>Code: Create sankey plot of paper destinations</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wrangle data for plot:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sankey_data<span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(PMID, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Label =</span> <span class="fu">str_replace_all</span>(Label, <span class="st">"_"</span>, <span class="st">" "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">str_to_title</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Behavioural_addiction =</span> <span class="fu">case_when</span>(Label <span class="sc">==</span> <span class="st">"Tanning"</span> <span class="sc">|</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>                                       Label <span class="sc">==</span> <span class="st">"Selfie"</span> <span class="sc">|</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                                       Label <span class="sc">==</span> <span class="st">"Crime"</span> <span class="sc">|</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                                       Label <span class="sc">==</span> <span class="st">"Dance"</span> <span class="sc">|</span></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>                                       Label <span class="sc">==</span> <span class="st">"Joyriding"</span> <span class="sc">|</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                                       Label <span class="sc">==</span> <span class="st">"Polysurgical"</span> <span class="sc">|</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                                       Label <span class="sc">==</span> <span class="st">"Death"</span> <span class="sc">|</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                                         Label <span class="sc">==</span> <span class="st">"Near Death"</span> <span class="sc">|</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>                                         Label <span class="sc">==</span> <span class="st">"Fortune Telling"</span> <span class="sc">|</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                                         Label <span class="sc">==</span> <span class="st">"Love"</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>                                         <span class="sc">~</span> <span class="st">"More obscure </span><span class="sc">\"</span><span class="st">addictions</span><span class="sc">\"</span><span class="st">"</span>,</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>                                     <span class="cn">TRUE</span> <span class="sc">~</span> Label))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="callout callout-style-simple callout-tip no-icon callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand for session information
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<details>
<summary>Code: Get session info</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">session_info</span>(<span class="at">pkgs =</span> <span class="st">"attached"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>â”€ Session info â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 setting  value
 version  R version 4.3.1 (2023-06-16 ucrt)
 os       Windows 10 x64 (build 19045)
 system   x86_64, mingw32
 ui       RTerm
 language (EN)
 collate  English_United Kingdom.utf8
 ctype    English_United Kingdom.utf8
 tz       Europe/London
 date     2023-09-18
 pandoc   3.1.1 @ C:/Program Files/RStudio/resources/app/bin/quarto/bin/tools/ (via rmarkdown)

â”€ Packages â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
 package     * version  date (UTC) lib source
 av          * 0.8.3    2023-02-05 [1] CRAN (R 4.3.0)
 Cairo       * 1.6-0    2022-07-05 [1] CRAN (R 4.3.0)
 dplyr       * 1.1.2    2023-04-20 [1] CRAN (R 4.3.1)
 forcats     * 1.0.0    2023-01-29 [1] CRAN (R 4.3.1)
 gganimate   * 1.0.8    2022-09-08 [1] CRAN (R 4.3.1)
 ggplot2     * 3.4.2    2023-04-03 [1] CRAN (R 4.3.1)
 ggtext      * 0.1.2    2022-09-16 [1] CRAN (R 4.3.1)
 gifski      * 1.12.0-1 2023-06-08 [1] CRAN (R 4.3.0)
 groundhog   * 3.1.0    2023-05-05 [1] CRAN (R 4.3.1)
 gt          * 0.9.0    2023-03-31 [1] CRAN (R 4.3.1)
 gtExtras    * 0.4.5    2022-11-28 [1] CRAN (R 4.3.1)
 htmlwidgets * 1.6.2    2023-03-17 [1] CRAN (R 4.3.1)
 lubridate   * 1.9.2    2023-02-10 [1] CRAN (R 4.3.1)
 maps        * 3.4.1    2022-10-30 [1] CRAN (R 4.3.1)
 plotly      * 4.10.2   2023-06-03 [1] CRAN (R 4.3.1)
 png         * 0.1-8    2022-11-29 [1] CRAN (R 4.3.0)
 purrr       * 1.0.1    2023-01-10 [1] CRAN (R 4.3.1)
 readr       * 2.1.4    2023-02-10 [1] CRAN (R 4.3.1)
 rmarkdown   * 2.23     2023-07-01 [1] CRAN (R 4.3.1)
 scico       * 1.4.0    2023-05-30 [1] CRAN (R 4.3.0)
 sessioninfo * 1.2.2    2021-12-06 [1] CRAN (R 4.3.1)
 showtext    * 0.9-6    2023-05-03 [1] CRAN (R 4.3.1)
 showtextdb  * 3.0      2020-06-04 [1] CRAN (R 4.3.1)
 stringr     * 1.5.0    2022-12-02 [1] CRAN (R 4.3.1)
 sysfonts    * 0.8.8    2022-03-13 [1] CRAN (R 4.3.1)
 tibble      * 3.2.1    2023-03-20 [1] CRAN (R 4.3.1)
 tidyr       * 1.3.0    2023-01-24 [1] CRAN (R 4.3.1)
 tidyverse   * 2.0.0    2023-02-22 [1] CRAN (R 4.3.1)
 transformr  * 0.1.4    2022-08-18 [1] CRAN (R 4.3.1)
 viridis     * 0.6.4    2023-07-22 [1] CRAN (R 4.3.1)
 viridisLite * 0.4.2    2023-05-02 [1] CRAN (R 4.3.1)

 [1] C:/Users/rheirene/AppData/Local/R/win-library/4.3
 [2] C:/Program Files/R/R-4.3.1/library

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</code></pre>
</div>
</div>
</div>
</div>
</div>
<hr>
<script src="https://giscus.app/client.js" data-repo="rheirene/Quarto_Website" data-repo-id="R_kgDOJ0d4fA" data-category-id="DIC_kwDOJ0d4fM4CXv7I" data-mapping="pathname" data-strict="0" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="bottom" data-theme="dark_dimmed" data-lang="en" crossorigin="anonymous" async="">
</script>
<p><span class="hidden" data-render-id="quarto-int-sidebar-title">Rob Heirene</span> <span class="hidden" data-render-id="quarto-int-navbar-title">Rob Heirene</span> <span class="hidden" data-render-id="quarto-int-navbar:About">About</span> <span class="hidden" data-render-id="quarto-int-navbar:/about.html">/about.html</span> <span class="hidden" data-render-id="quarto-int-navbar:Addiction Science Blog">Addiction Science Blog</span> <span class="hidden" data-render-id="quarto-int-navbar:/posts.html">/posts.html</span> <span class="hidden" data-render-id="quarto-int-navbar:Publications">Publications</span> <span class="hidden" data-render-id="quarto-int-navbar:/publication.html">/publication.html</span> <span class="hidden" data-render-id="quarto-navbar-tools:mailto:robheirene@gmail.com">mailto:robheirene@gmail.com</span> <span class="hidden" data-render-id="quarto-navbar-tools:https://github.com/rheirene">https://github.com/rheirene</span> <span class="hidden" data-render-id="quarto-navbar-tools:https://scholar.google.co.uk/citations?user=2bz0qnsAAAAJ&amp;hl=en">https://scholar.google.co.uk/citations?user=2bz0qnsAAAAJ&amp;hl=en</span> <span class="hidden" data-render-id="quarto-navbar-tools:https://osf.io/atwg5/">https://osf.io/atwg5/</span> <span class="hidden" data-render-id="quarto-navbar-tools:https://twitter.com/RHeirene">https://twitter.com/RHeirene</span> <span class="hidden" data-render-id="quarto-navbar-tools:https://www.linkedin.com/in/robert-heirene/">https://www.linkedin.com/in/robert-heirene/</span> <span class="hidden" data-render-id="footer-left">Copyright 2023, Rob Heirene (<a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>)</span> <span class="hidden" data-render-id="footer-right">View source code on <a href="https://github.com/rheirene/Quarto_Website">Github</a></span></p>
</section></main></div>



 <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
 <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      <div class="footer-contents">Copyright 2023, Rob Heirene ([CC BY-SA 4.0](https://creativecommons.org/licenses/by-sa/4.0/))</div>  
    </div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      <div class="footer-contents">View source code on [Github](https://github.com/rheirene/Quarto_Website)</div>  
    </div>
  </div>
</footer>



</body></html>