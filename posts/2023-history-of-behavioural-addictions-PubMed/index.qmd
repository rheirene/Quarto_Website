---
title: "The history of behavioural addictions research (according to PubMed)"
description: ""
author:
  - name: Rob Heirene
categories: [Gambling] 
date: 2023-08-25
draft: true 
---

```{r results=FALSE, warning=FALSE, message=FALSE}
#| code-fold: true
#| code-summary: "Code: set-up"

# Install and load the groundhog package to ensure consistency of the package versions used here:
# install.packages("groundhog") # Install

library(groundhog) # Load

# List desired packages:
packages <- c('readr', # Load dataset from GitHib
              'RCurl', # Load dataset from GitHib
              'tidyverse', # Clean, organise, and visualise data
              'plotly', # Add interactive elements to figures
              'gganimate', # Make animated plots
              'png',# Helps render gganimate plots
              'gifski', # Helps render gganimate plots
              'rmarkdown', # Helps render gganimate plots
              'av', # render gganimate plots as videos
              'Cairo', # Anti-aliasing for the line plots (smoothing output)
              'ggtext', # make fancy labels in plots
              'sysfonts', # Special fonts for figures
              'showtext', # Special fonts for figures
              'htmlwidgets') # Make plotly plots HTML format for rendering in Quarto
              

# Load desired package with versions specific to project start date:
groundhog.library(packages, "2023-08-01") 

# Load new font for figures/graphs
font_add_google("Poppins", "Poppins")
font_add_google("Reem Kufi", "Reem Kufi")
showtext_auto(enable = TRUE) 
```

```{r results=FALSE, warning=FALSE, message=FALSE}
#| code-fold: true
#| code-summary: "Code: load dataset"

url_behav_addic_data_link <- "https://raw.githubusercontent.com/rheirene/pub-med-scape-behav-addictions/main/Data%20extraction/combined_results_clean.csv"

raw_data <- read_csv(url_behav_addic_data_link) %>%
  as_tibble()

str(raw_data)
# View(raw_data)

```

```{r include=FALSE}
raw_data %>%
  distinct(PMID) %>%
  nrow() %>%
  as_tibble() %>%
  mutate(full_count = nrow(raw_data)) %>%
  mutate(full_unique_discrepancy = full_count-value) %>%
  rename(unique_count = value)

# Find the first study for each "addiction":
raw_data %>%
  distinct(PMID, .keep_all = TRUE) %>%
  group_by(Label) %>% 
  summarise(
    min = min(Year),
    max = max(Year)
  ) %>% 
  arrange(min) %>% 
  print(n=22)
```

```{r  warning=FALSE, message=FALSE}
#| code-fold: true
#| code-summary: "Code: Animated line graph"
#| fig-align: center

# Prepare data:
data_total_per_year_pubs <- raw_data %>%
   distinct(PMID, .keep_all = TRUE) %>%
   filter(Year != "2023") %>%
   group_by(Year) %>%
   count() %>%
   ungroup() %>%
  mutate(first_study_1961_label = case_when(Year >= 1961 & Year < 1980 ~ sprintf("1961  \nFirst available study: \n\"Compulsive gambling\""),
                               TRUE ~ "")) %>%
  mutate(gam_1980_label = case_when(Year >= 1980 & Year < 1994 ~ sprintf("1980  \nPathological Gambling added \nto DSM (version III)"),
                               TRUE ~ "")) %>%
  mutate(behav_addic_1994_label = case_when(Year >= 1994 & Year < 2004 ~ sprintf("1994  \nFirst mention of \"Behavioural \n addictions\" in the literature"),
                               TRUE ~ "")) %>%
  mutate(first_gaming_2004_label = case_when(Year >= 2004 & Year < 2013 ~ sprintf("1961  \nFirst available studies \non gaming addiction"),
                               TRUE ~ "")) %>%
  mutate(gam_DSMV_label = case_when(Year >= 2013 & Year < 2021 ~ sprintf("2013 \n\"Gambling disorder\"\nadded in \"addictive \ndisorders\" class in \nDSM-V"),
                               TRUE ~ ""))                     
                   
  
total_year_gganimate <- data_total_per_year_pubs %>%
   ggplot(aes(Year, n)) + 
   geom_point() + 
   geom_line(size = 1.1, color = "#289998") + 
  # Add year counting label
   geom_text(aes(x = 1984, y = 370, label = as.factor(Year)), hjust = 0, vjust = 0, alpha = 0.6, col = "#F5F7F0", size = 15, family = "Reem Kufi") +
  # Add 1961 first study label
  geom_text(aes(x = 1955, y =90, label = first_study_1961_label), hjust = 0, vjust = 0, alpha = 0.9, col = "#F5F7F0", size = 4, family = "Reem Kufi") +
  # Add 1980 gambling label
  geom_text(aes(x = 1970, y =100, label = gam_1980_label), hjust = 0, vjust = 0, alpha = 0.9, col = "#F5F7F0", size = 4, family = "Reem Kufi") +
  # Add 1994 behavioural addictions label
  geom_text(aes(x = 1984, y =110, label = behav_addic_1994_label), hjust = 0, vjust = 0, alpha = 0.9, col = "#F5F7F0", size = 4, family = "Reem Kufi") +
   # Add 2013 gambling label
  # Add 2004 gaming addiction label
  geom_text(aes(x = 1994, y =150, label = first_gaming_2004_label), hjust = 0, vjust = 0, alpha = 0.9, col = "#F5F7F0", size = 4, family = "Reem Kufi") +
   # Add 2013 gambling label
  geom_text(aes(x = 2000, y =320, label = gam_DSMV_label), hjust = 0, vjust = 0, alpha = 0.9, col = "#F5F7F0", size = 4, family = "Reem Kufi") +
# Define x-axis dates
  scale_x_continuous(breaks = seq(1960, 2020, by = 10)) +  
   theme(
     plot.background = element_rect(fill = "#002B36",  color = NA), # ADDING THIS NA REMOVES BORDER AROUND PLOT ON WEBSITE
     panel.background = element_rect(fill = "#002B36"),
     text = element_text(family = "Reem Kufi", color = "#F5F7F0"),
     axis.text = element_text(color = "#F5F7F0", size = 12),
     panel.grid = element_blank(),
     plot.margin = margin(20, 5, 20, 20),
     axis.title.y = element_blank(),  # Adjust y-axis title position
     axis.title.x = element_text(margin = margin(t = 15), size = 14),
     plot.title = element_text(color = "#F5F7F0", size = 16, margin = margin(b = 15))
     # panel.border = element_rect(color = "#002B36")
   ) +
   labs(
     title = "Number of Behavioural Addictions papers published per year on PubMed",  # Add header
     subtitle = "Up to end of 2022",
     x = "Year"
   ) +
   transition_reveal(Year) + 
  enter_fade() + 
  exit_shrink() 
      # view_follow()
  
animate(total_year_gganimate, 
        width = 740, height = 420, 
        rewind = FALSE, 
        type = "cairo") 

animate(
  total_year_gganimate,
  width = 740, height = 420, 
        rewind = FALSE, 
        type = "cairo",
  renderer = av_renderer()
)

```

```{r include = FALSE}
anim_save("posts/2023-history-of-behavioural-addictions-PubMed/total_year_gganimate.gif", animation = last_animation())
```

Now let's start to look publication rates for each "addiction" in our dataset.

------------------------------------------------------------------------

```{=html}
<script src="https://giscus.app/client.js"
        data-repo="rheirene/Quarto_Website"
        data-repo-id="R_kgDOJ0d4fA"
        data-category-id="DIC_kwDOJ0d4fM4CXv7I"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="dark_dimmed"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script
```
